Math.roundTo=function(a,b){b=1/b;return Math.round(a*b)/b};Array.prototype.sortOn=function(a){if("string"!==typeof a)throw new TypeError(a+" is not a string");if("[object Array]"===Object.prototype.toString.call(this))return this.sort(function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0});throw new TypeError(this+" is not an array");};var root=this,CORE_UI=CORE_UI||{};root.CORE_UI=CORE_UI;CORE_UI.MENU_DIALOG_CONTAINER=document.querySelector("#menu_dialogs");CORE_UI.MENU={};
CORE_UI.MENU.Edit={$:document.querySelector("#menu_edit"),active:!1};CORE_UI.MENU.Modify={$:document.querySelector("#menu_modify"),active:!1};
CORE_UI.init=function(){document.querySelector("#menu_connect").addEventListener("click",function(a){CORE.Connector.loginModal()});CORE.DOM.AddSheet.addEventListener("click",function(){CORE.Sheets.addSheet()});document.querySelector("#import_file").addEventListener("change",function(a){a=a.target;var b=new FileReader;b.onload=function(){if(b.result.substr(11).match("png")){var a=new Image;a.src=b.result;AJAX.POST(a.src,"server/base64ToImage.php",function(b){a=new Image;a.src="server/uploads/"+b;JS2PNG.Decode(a,
function(a){CORE.File["import"](a)})})}else CORE.File["import"](b.result)};b.readAsText(a.files[0])});CORE_UI.initCellStyleMenu()};CORE_UI.closeAllMenus=function(){for(var a=document.querySelector("#menu_dialogs"),b=0;b<a.children.length;++b)a.children[b].style.display="none";for(b in CORE_UI.MENU)CORE_UI.MENU[b].active=!1};CORE_UI.ACTION={save:function(){CORE.File["export"]()},saveImage:function(){CORE.File.exportImage()},open:function(){CORE.File["import"]()}};
CORE_UI.initCellStyleMenu=function(){CORE_UI.initFontChangeMenu();CORE_UI.initBorderChangeMenu();CORE_UI.initBackgroundChangeMenu();CORE_UI.initInjectionButtons()};
CORE_UI.initBorderChangeMenu=function(){CORE.DOM.ChangeCellBorder.addEventListener("click",function(a){a=CORE.DOM.ChangeCellBorder;a.parentNode&&("true"===a.parentNode.getAttribute("hide")?(CORE.DOM.ChangeCellBorderMenu.style.display="block",a.parentNode.setAttribute("hide","false")):"false"===a.parentNode.getAttribute("hide")&&(CORE.DOM.ChangeCellBorderMenu.style.display="none",a.parentNode.setAttribute("hide","true")));CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()});for(var a=0;a<CORE.DOM.ChangeCellBorderMenuItems.children.length;++a)CORE.DOM.ChangeCellBorderMenuItems.children[a].id&&
CORE.DOM.ChangeCellBorderMenuItems.children[a].addEventListener("click",function(a){var c=null;a.target.id?c=a.target.id:a.target.parentNode.id&&(c=a.target.parentNode.id);CORE.$.validateCells();CORE_UI.updateCellBorder(c);CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()})};
CORE_UI.updateCellBorder=function(a){for(var b=null,c=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,e=CORE.Sheets[CORE.CurrentSheet].Selector,c=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current&&null!==CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current?c.Columns[c.Current]||c.Rows[c.Current]:null,d=0;d<e.SelectedCells.length;++d){var f=CORE.$.numberToAlpha(e.SelectedCells[d].letter),g=f+e.SelectedCells[d].number,b=CORE.$.getCell({letter:e.SelectedCells[d].letter,
number:e.SelectedCells[d].number});CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.used||(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.used=!0);c&&(c.Border.used=!0);if("border_left"===a){if(c){c.Border.left=c.Border.left?!1:!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");e.getSelection();break}CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.left?(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.left=null,0<=b&&(CORE.DOM.Output.children[b].style.borderLeft="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.left=
!0,0<=b&&(CORE.DOM.Output.children[b].style.borderLeft="2px solid black"))}if("border_right"===a){if(c){c.Border.right=c.Border.right?!1:!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");e.getSelection();break}CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.right?(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.right=null,0<=b&&(CORE.DOM.Output.children[b].style.borderRight="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.right=!0,0<=b&&(CORE.DOM.Output.children[b].style.borderRight="2px solid black"))}if("border_top"===
a){if(c){c.Border.top=c.Border.top?!1:!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");e.getSelection();break}CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.top?(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.top=null,0<=b&&(CORE.DOM.Output.children[b].style.borderTop="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.top=!0,0<=b&&(CORE.DOM.Output.children[b].style.borderTop="2px solid black"))}if("border_bottom"===a){if(c){c.Border.bottom=c.Border.bottom?!1:!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");
e.getSelection();break}CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.bottom?(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.bottom=null,0<=b&&(CORE.DOM.Output.children[b].style.borderBottom="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.bottom=!0,0<=b&&(CORE.DOM.Output.children[b].style.borderBottom="2px solid black"))}if("border_all"===a){if(c){c.Border.full?c.Border.full=!1:(c.Border.full=!0,c.Border.left=!1,c.Border.right=!1,c.Border.top=!1,c.Border.bottom=!1);CORE.Sheets[CORE.CurrentSheet].updateWidth("default");
e.getSelection();break}CORE.Cells.Used[f][g].Border.full?(CORE.Cells.Used[f][g].Border.full=!1,0<=b&&(CORE.DOM.Output.children[b].style.border="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.full=!0,CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.left=!1,CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.right=!1,CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.top=!1,CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.bottom=!1,0<=b&&(CORE.DOM.Output.children[b].style.border="2px solid black"))}if("border_outer"===
a){if(c){c.Border.left=c.Border.left?!1:!0;c.Border.right=c.Border.right?!1:!0;0<=b&&(c.Border.left&&(CORE.DOM.Output.children[b].style.borderLeft="2px solid black"),c.Border.right&&(CORE.DOM.Output.children[b].style.borderRight="2px solid black"));CORE.Sheets[CORE.CurrentSheet].updateWidth("default");e.getSelection();break}e.drawOuterBorder();break}}};
CORE_UI.initFontChangeMenu=function(){var a=document.querySelector("#font_colorpicker"),b=new EightBitColorPicker({el:a});CORE.DOM.ChangeFont.addEventListener("change",function(a){var b=0,d=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,b=d.Current,f=CORE.Sheets[CORE.CurrentSheet].Selector;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current&&null!==CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current&&(d=d.Columns[d.Current]||d.Rows[d.Current])&&(d.Font=a.target.value);
CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Sheets[CORE.CurrentSheet].Selector.inheritMasterStyling(b,d,"Font");for(d=0;d<f.SelectedCells.length;++d){var b=CORE.$.numberToAlpha(f.SelectedCells[d].letter),g=b+f.SelectedCells[d].number;CORE.Cells.Used[CORE.CurrentSheet][b][g]&&(CORE.Cells.Used[CORE.CurrentSheet][b][g].Font=a.target.value,b=CORE.$.getCell({letter:f.SelectedCells[d].letter,number:f.SelectedCells[d].number}),0<=b&&(CORE.DOM.Output.children[b].style.fontFamily=a.target.children[a.target.selectedIndex].getAttribute("value")))}f.getSelection()});
CORE.DOM.ChangeFont.addEventListener("click",function(a){CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()});CORE.DOM.ChangeFontSize.addEventListener("change",function(a){var b=0,d=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,b=d.Current,f=CORE.Sheets[CORE.CurrentSheet].Selector;f.masterSelected.Current&&null!==f.masterSelected.Current&&(d=d.Columns[d.Current]||d.Rows[d.Current])&&(d.FontSize=~~a.target.value);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][b]&&f.inheritMasterStyling(b,
d,"FontSize");for(d=0;d<f.SelectedCells.length;++d)b=CORE.$.numberToAlpha(f.SelectedCells[d].letter),CORE.Cells.Used[CORE.CurrentSheet][b][b+f.SelectedCells[d].number].FontSize=~~a.target.value,b=CORE.$.getCell({letter:f.SelectedCells[d].letter,number:f.SelectedCells[d].number}),0<=b&&(CORE.DOM.Output.children[b].style.fontSize=a.target.children[a.target.selectedIndex].getAttribute("value")+"px");f.getSelection()});CORE.DOM.ChangeFontSize.addEventListener("click",function(a){CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()});
CORE.DOM.ChangeFontBold.addEventListener("click",function(a){var b=0,d=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,b=d.Current;a=CORE.Sheets[CORE.CurrentSheet].Selector;a.masterSelected.Current&&null!==a.masterSelected.Current&&(d=d.Columns[d.Current]||d.Rows[d.Current])&&(d.FontBold=d.FontBold?!1:!0);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][b]&&a.inheritMasterStyling(b,d,"FontBold");for(d=0;d<a.SelectedCells.length;++d){var b=CORE.$.numberToAlpha(a.SelectedCells[d].letter),
f=b+a.SelectedCells[d].number;CORE.Cells.Used[CORE.CurrentSheet][b][f].FontBold?(CORE.Cells.Used[CORE.CurrentSheet][b][f].FontBold=!1,b=CORE.$.getCell({letter:a.SelectedCells[d].letter,number:a.SelectedCells[d].number}),0<=b&&(CORE.DOM.Output.children[b].style.fontWeight="normal")):(CORE.Cells.Used[CORE.CurrentSheet][b][f].FontBold=!0,b=CORE.$.getCell({letter:a.SelectedCells[d].letter,number:a.SelectedCells[d].number}),0<=b&&(CORE.DOM.Output.children[b].style.fontWeight="bold"))}a.getSelection()});
CORE.DOM.ChangeFontItalic.addEventListener("click",function(a){var b=0,d=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,b=d.Current;a=CORE.Sheets[CORE.CurrentSheet].Selector;a.masterSelected.Current&&null!==a.masterSelected.Current&&(d=d.Columns[d.Current]||d.Rows[d.Current])&&(d.FontItalic=d.FontItalic?!1:!0);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][b]&&a.inheritMasterStyling(b,d,"FontItalic");for(d=0;d<a.SelectedCells.length;++d){var b=CORE.$.numberToAlpha(a.SelectedCells[d].letter),
f=b+a.SelectedCells[d].number;CORE.Cells.Used[CORE.CurrentSheet][b][f].FontItalic?(CORE.Cells.Used[CORE.CurrentSheet][b][f].FontItalic=!1,b=CORE.$.getCell({letter:a.SelectedCells[d].letter,number:a.SelectedCells[d].number}),0<=b&&(CORE.DOM.Output.children[b].style.fontStyle="normal")):(CORE.Cells.Used[CORE.CurrentSheet][b][f].FontItalic=!0,b=CORE.$.getCell({letter:a.SelectedCells[d].letter,number:a.SelectedCells[d].number}),0<=b&&(CORE.DOM.Output.children[b].style.fontStyle="italic"))}a.getSelection()});
CORE.DOM.ChangeFontUnderline.addEventListener("click",function(a){var b=0,d=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,b=d.Current;a=CORE.Sheets[CORE.CurrentSheet].Selector;a.masterSelected.Current&&null!==a.masterSelected.Current&&(d=d.Columns[d.Current]||d.Rows[d.Current])&&(d.FontUnderlined=d.FontUnderlined?!1:!0);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][b]&&a.inheritMasterStyling(b,d,"FontUnderlined");for(d=0;d<a.SelectedCells.length;++d){var b=CORE.$.numberToAlpha(a.SelectedCells[d].letter),
f=b+a.SelectedCells[d].number;CORE.Cells.Used[CORE.CurrentSheet][b][f].FontUnderlined?(CORE.Cells.Used[CORE.CurrentSheet][b][f].FontUnderlined=!1,b=CORE.$.getCell({letter:a.SelectedCells[d].letter,number:a.SelectedCells[d].number}),0<=b&&(CORE.DOM.Output.children[b].style.textDecoration="none")):(CORE.Cells.Used[CORE.CurrentSheet][b][f].FontUnderlined=!0,b=CORE.$.getCell({letter:a.SelectedCells[d].letter,number:a.SelectedCells[d].number}),0<=b&&(CORE.DOM.Output.children[b].style.textDecoration="underline"))}a.getSelection()});
CORE.DOM.ChangeFontColor.addEventListener("click",function(c){var e=CORE.DOM.ChangeFontColor,d=0;c=CORE.Sheets[CORE.CurrentSheet].Selector;e.parentNode.children[1]&&("true"===e.parentNode.children[1].getAttribute("hide")?(e.parentNode.children[1].setAttribute("hide","false"),b.show()):"false"===e.parentNode.children[1].getAttribute("hide")&&(e.parentNode.children[1].setAttribute("hide","true"),b.hide()));d=c.masterSelected;e=d.Current;c.masterSelected.Current&&null!==c.masterSelected.Current&&(d=
d.Columns[d.Current]||d.Rows[d.Current])&&(d.Color=a.children[0].style.background);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][e]&&c.inheritMasterStyling(e,d,"Color");for(e=0;e<c.SelectedCells.length;++e)d=CORE.$.numberToAlpha(c.SelectedCells[e].letter),CORE.Cells.Used[CORE.CurrentSheet][d][d+c.SelectedCells[e].number].Color=a.children[0].style.background,d=CORE.$.getCell({letter:c.SelectedCells[e].letter,number:c.SelectedCells[e].number}),0<=d&&(CORE.DOM.Output.children[d].style.color=
a.children[0].style.background);c.getSelection()})};
CORE_UI.initBackgroundChangeMenu=function(){var a=document.querySelector("#background_colorpicker");new EightBitColorPicker({el:a});CORE.DOM.ChangeCellBackground.addEventListener("click",function(b){b=CORE.Sheets[CORE.CurrentSheet].Selector;var c=b.masterSelected,e=c.Current;c.Current&&null!==c.Current&&(c=c.Columns[c.Current]||c.Rows[c.Current])&&(c.BackgroundColor=a.children[0].style.background);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][e]&&b.inheritMasterStyling(e,c,"BackgroundColor");
for(c=0;c<b.SelectedCells.length;++c)e=CORE.$.numberToAlpha(b.SelectedCells[c].letter),CORE.Cells.Used[CORE.CurrentSheet][e][e+b.SelectedCells[c].number].BackgroundColor=a.children[0].style.background,e=CORE.$.getCell({letter:b.SelectedCells[c].letter,number:b.SelectedCells[c].number}),0<=e&&(CORE.DOM.Output.children[e].style.background=a.children[0].style.background);b.getSelection()})};CORE_UI.initLiveCellMenu=function(){};
CORE_UI.initInjectionButtons=function(){CORE.DOM.InsertColumn.addEventListener("click",function(){CORE.Injector.insertColumn()});CORE.DOM.DeleteColumn.addEventListener("click",function(){CORE.Injector.deleteColumn()});CORE.DOM.InsertRow.addEventListener("click",function(){CORE.Injector.insertRow()});CORE.DOM.DeleteRow.addEventListener("click",function(){CORE.Injector.deleteRow()})};
CORE_UI.updateCellStyleMenu=function(a){var b=CORE.$.numberToAlpha(a.letter);a=a.number;var c=b+a,e=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns,d=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows;CORE.DOM.CellInput.value=CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Cells.Used[CORE.CurrentSheet][b][c]?CORE.Cells.Used[CORE.CurrentSheet][b][c].Formula?CORE.Cells.Used[CORE.CurrentSheet][b][c].Formula:void 0!==CORE.Cells.Used[CORE.CurrentSheet][b][c].Content&&null!==CORE.Cells.Used[CORE.CurrentSheet][b][c].Content?
CORE.Cells.Used[CORE.CurrentSheet][b][c].Content:"":"";CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Cells.Used[CORE.CurrentSheet][b][c]?(CORE.DOM.ChangeFont.value=CORE.Cells.Used[CORE.CurrentSheet][b][c].Font?CORE.Cells.Used[CORE.CurrentSheet][b][c].Font:"Arial",CORE.DOM.ChangeFontSize.value=CORE.Cells.Used[CORE.CurrentSheet][b][c].FontSize?CORE.Cells.Used[CORE.CurrentSheet][b][c].FontSize:12,CORE.DOM.ChangeFontColor.style.background=CORE.Cells.Used[CORE.CurrentSheet][b][c].Color?CORE.Cells.Used[CORE.CurrentSheet][b][c].Color:
"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background=CORE.Cells.Used[CORE.CurrentSheet][b][c].FontBold?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontItalic.style.background=CORE.Cells.Used[CORE.CurrentSheet][b][c].FontItalic?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontUnderline.style.background=CORE.Cells.Used[CORE.CurrentSheet][b][c].FontUnderlined?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeCellBackground.style.background=
CORE.Cells.Used[CORE.CurrentSheet][b][c].BackgroundColor?CORE.Cells.Used[CORE.CurrentSheet][b][c].BackgroundColor:"rgba(50, 50, 50, 0.70)"):e[b]?(CORE.DOM.ChangeCellBackground.style.background=e[b].BackgroundColor?e[b].BackgroundColor:"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFont.value=e[b].Font?e[b].Font:"Arial",e[b].FontSize?CORE.DOM.ChangeFont.value=e[b].FontSize:CORE.DOM.ChangeFontSize.value=12,CORE.DOM.ChangeFontColor.style.background=e[b].Color?e[b].Color:"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background=
e[b].FontBold?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background=e[b].FontItalic?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background=e[b].FontUnderlined?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)"):d[a]?(CORE.DOM.ChangeCellBackground.style.background=d[a].BackgroundColor?d[a].BackgroundColor:"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFont.value=d[a].Font?d[a].Font:CORE.DOM.ChangeFont.children[0].getAttribute("value"),
d[a].FontSize?CORE.DOM.ChangeFont.value=d[a].FontSize:CORE.DOM.ChangeFontSize.value=CORE.DOM.ChangeFontSize.children[6].getAttribute("value"),d[a].Color?CORE.DOM.ChangeFont.value=d[a].Color:CORE.DOM.ChangeFontColorPreview.style.color="#c7c7c7",d[a].FontBold?(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="rgba(68, 138, 255, 0.75)",CORE.DOM.ChangeFontBoldPreview.style.color="#7d7d7d"):(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="#fff",CORE.DOM.ChangeFontBoldPreview.style.color=
"#c7c7c7"),d[a].FontItalic?(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="rgba(68, 138, 255, 0.75)",CORE.DOM.ChangeFontBoldPreview.style.color="#7d7d7d"):(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="#fff",CORE.DOM.ChangeFontBoldPreview.style.color="#c7c7c7"),d[a].FontUnderlined?(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="rgba(68, 138, 255, 0.75)",CORE.DOM.ChangeFontBoldPreview.style.color="#7d7d7d"):(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background=
"#fff",CORE.DOM.ChangeFontBoldPreview.style.color="#c7c7c7")):(CORE.DOM.CellInput.textContent="",CORE.DOM.ChangeFont.value="Arial",CORE.DOM.ChangeFontSize.value=12,CORE.DOM.ChangeFontColor.style.background="rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background="rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontItalic.style.background="rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontUnderline.style.background="rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeCellBackground.style.background="rgba(50, 50, 50, 0.70)")};
var root=this,CORE=CORE||{};CORE.VERSION="0.3";CORE.DOM={};CORE.Settings={Width:window.innerWidth,Height:window.innerHeight};CORE.Cells={Used:{},Live:{}};CORE.CurrentSheet="Sheet1";CORE.SheetCount=0;CORE.Settings.Mobile=!1;CORE.Settings.isIOS=!1;CORE.Settings.isAndroid=!1;CORE.Settings.Scroll={Vertical:1,OriginalVertical:1,Horizontal:1,OriginalHorizontal:1};CORE.REGEX={numbers:/[^0-9]/g,letters:/[^a-zA-Z]/gi,variable:/[a-zA-Z_][a-zA-Z0-9_]+/gi};root.CORE=CORE;CORE.DOM.Cache={};
CORE.DOM.FileOutput=document.querySelector("#file");CORE.DOM.MainContainer=document.querySelector("#container");CORE.DOM.Output=document.querySelector("#output");CORE.DOM.VerticalMenu=document.querySelector("#number_menu");CORE.DOM.HorizontalMenu=document.querySelector("#letter_menu");CORE.DOM.CurrentCell=document.querySelector("#current_cell");CORE.DOM.DebugContainer=document.querySelector("#debug");CORE.DOM.ChangeFont=document.querySelector("#change_font");CORE.DOM.ChangeFontSize=document.querySelector("#change_fontSize");
CORE.DOM.ChangeFontColor=document.querySelector("#change_fontColor");CORE.DOM.ChangeFontBold=document.querySelector("#change_bold");CORE.DOM.ChangeFontItalic=document.querySelector("#change_italic");CORE.DOM.ChangeFontUnderline=document.querySelector("#change_underline");CORE.DOM.ChangeLiveCell=document.querySelector("#change_livecell");CORE.DOM.LiveCellOutput=document.querySelector("#livecell_current");CORE.DOM.LiveCellContainer=document.querySelector("#livecell_current_container");
CORE.DOM.ChangeCellBorder=document.querySelector("#change_border");CORE.DOM.ChangeCellBorderMenu=document.querySelector("#border_settings_menu");CORE.DOM.ChangeCellBorderMenuItems=document.querySelector("#border_settings_menu_items");CORE.DOM.ChangeCellBackground=document.querySelector("#change_background");CORE.DOM.InsertColumn=document.querySelector("#insert_column");CORE.DOM.DeleteColumn=document.querySelector("#delete_column");CORE.DOM.InsertRow=document.querySelector("#insert_row");
CORE.DOM.DeleteRow=document.querySelector("#delete_row");CORE.DOM.AddSheet=document.querySelector("#add_sheet");CORE.DOM.Sheets=document.querySelector("#current_sheets");CORE.DOM.CellInput=document.querySelector("#cell_input");
CORE.eval=function(a){var b=null,c=null;a?(b=CORE.Cells.Used[a],c=CORE.Cells.Used[a]):(b=CORE.Cells.Used[CORE.CurrentSheet],c=CORE.Cells.Used[CORE.CurrentSheet]);a=[];var e=0,d;for(d in b)for(var f in b[d])b[d][f].Formula&&b[d][f].Formula.length&&a.push({name:f,value:b[d][f].Formula.substr(0,0)+f+b[d][f].Formula.substr(0),variableReferences:CORE.$.getVariables(b[d][f].Formula.substr(0))});if(a&&a.length)for(d=0;d<a.length;++d)b=a[d].name.match(CORE.REGEX.numbers).join(""),e=ENGEL.interpret(a[d].value).VAR[a[d].name].value.value,
c[b][a[d].name].Content=e,f=a[d].name,b=CORE.$.alphaToNumber(f.match(CORE.REGEX.numbers).join("")),f=~~f.match(CORE.REGEX.letters).join(""),b=CORE.$.getCell({letter:b,number:f}),0<=b&&(CORE.DOM.Output.children[b].innerHTML=e)};CORE.registerCellVariable=function(a){if(!ENGEL.STACK.get(a))if(ENGEL.STACK.createVariable(a),ENGEL.STACK.VAR[a])ENGEL.STACK.VAR[a].name=a;else throw Error("Fatal Error, failed to register "+a+"!");};CORE.validCell=function(a){return ENGEL.STACK.get(a)?!0:!1};
CORE.updateCell=function(a,b){ENGEL.STACK.get(a)&&ENGEL.STACK.update(a,{raw:b,value:ENGEL.TypeMaster(b).value,type:"number"})};CORE.registerCell=function(a){var b=a.match(CORE.REGEX.numbers).join(""),c=a.match(CORE.REGEX.letters).join("");CORE.$.registerCell({letter:b,number:c});CORE.registerCellVariable(a)};CORE.registerLiveCell=function(a){CORE.Cells.Live[a]=new CORE.Sheets[CORE.CurrentSheet].LiveCell};CORE.Event={};
CORE.Event.init=function(){CORE.Settings.Mobile?(window.addEventListener("resize",CORE.Event.resize,!1),window.addEventListener("touchstart",CORE.Event.mouseDown,!1),window.addEventListener("touchend",CORE.Event.mouseUp,!1),window.addEventListener("touchmove",CORE.Event.mouseWipe,!1),window.addEventListener("mousewheel",CORE.Event.scroll,!1),window.addEventListener("scroll",CORE.Event.scroll,!1),window.addEventListener("keydown",CORE.Event.keyPress,!1)):(window.addEventListener("resize",CORE.Event.resize,
!1),window.addEventListener("mousedown",CORE.Event.mouseDown,!1),window.addEventListener("mouseup",CORE.Event.mouseUp,!1),window.addEventListener("mousemove",CORE.Event.mouseWipe,!1),window.addEventListener("mousewheel",CORE.Event.scroll,!1),window.addEventListener("DOMMouseScroll",CORE.Event.scroll,!1),window.addEventListener("keydown",CORE.Event.keyPress,!1),window.addEventListener("keyup",CORE.Event.keyUp,!1))};
CORE.Event.resize=function(){CORE.Settings.Width=window.innerWidth;CORE.Settings.Height=window.innerHeight;CORE.Settings.Scroll.OriginalVertical=CORE.Settings.Scroll.Vertical=CORE.$.calculateScrollAmount();CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!1;CORE.Sheets[CORE.CurrentSheet].calculateGrid();CORE.Sheets[CORE.CurrentSheet].generateCells();CORE.Sheets[CORE.CurrentSheet].updateWidth("default");CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();CORE.Awakener.reset();CORE.Awakener.evalLive();
CORE.eval()};CORE.Event.animateMouseUp=function(){CORE.DOM.Output.classList.remove("moveDown");CORE.DOM.VerticalMenu.classList.remove("moveDown");CORE.DOM.Output.classList.remove("moveUp");CORE.DOM.VerticalMenu.classList.remove("moveUp");setTimeout(function(){CORE.DOM.Output.classList.add("moveDown");CORE.DOM.VerticalMenu.classList.add("moveDown");CORE.DOM.Output.style.top="-25px";CORE.DOM.VerticalMenu.style.top="75px"},1)};
CORE.Event.animateMouseUpMaximum=function(){CORE.DOM.Output.classList.remove("moveDown");CORE.DOM.VerticalMenu.classList.remove("moveDown");CORE.DOM.Output.classList.remove("moveUp");CORE.DOM.VerticalMenu.classList.remove("moveUp");CORE.DOM.Output.style.top="0px";CORE.DOM.VerticalMenu.style.top="100px"};
CORE.Event.animateMouseDown=function(){CORE.DOM.Output.classList.remove("moveDown");CORE.DOM.VerticalMenu.classList.remove("moveDown");CORE.DOM.Output.classList.remove("moveUp");CORE.DOM.VerticalMenu.classList.remove("moveUp");setTimeout(function(){CORE.DOM.Output.classList.add("moveUp");CORE.DOM.VerticalMenu.classList.add("moveUp")},55)};
CORE.Event.mouseDoubleClick=function(a){a.target.parentNode.id===CORE.DOM.Output.id&&(a=a.target.getAttribute("name"),CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].Selector.cellFocusSwitch=!1,CORE.Sheets[CORE.CurrentSheet].getEditSelection(a))};
CORE.Event.mouseDown=function(a){if(1===a.button||2===a.button||3===a.which||2===a.which||CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();else{CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown||(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown=a.timeStamp);if(0<CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown){var b=a.timeStamp-CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown;if(b&&250>=b&&
a.target.parentNode.id===CORE.DOM.Output.id&&a.target.getAttribute("name")===CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell){CORE.Event.mouseDoubleClick(a);return}}if("cell_input"===a.target.id)CORE.Sheets[CORE.CurrentSheet].Selector.Select.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Select.Number&&(CORE.eval(),CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].getEditSelection(CORE.Sheets[CORE.CurrentSheet].Selector.Select)),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();
else if(a.target.parentNode.id!==CORE.DOM.VerticalMenu.id&&a.target.parentNode.id!==CORE.DOM.HorizontalMenu.id){if(a.target.parentNode.id===CORE.DOM.Output.id){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.LiveCellEdit=!1;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null;CORE.DOM.LiveCellContainer.style.display="none";CORE.Sheets[CORE.CurrentSheet].Input.Mouse.startedMouseWipe=!0;var c=a.target.getAttribute("name"),b=CORE.$.alphaToNumber(c.match(CORE.REGEX.numbers).join("")),c=~~c.match(CORE.REGEX.letters).join(""),
e=CORE.$.numberToAlpha(b)+c;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell.Letter=b;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell.Number=c;CORE.Sheets[CORE.CurrentSheet].Selector.Select=CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell;CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First={Letter:b,Number:c};CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First;CORE.Sheets[CORE.CurrentSheet].Selector.parentSelectedCell=
CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First;CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY=0;CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Number&&CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();if(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit&&
CORE.Sheets[CORE.CurrentSheet].Selector.Edit!==CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First||CORE.Sheets[CORE.CurrentSheet].Selector.Edit!==CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First===CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last)CORE.eval(),CORE.Sheets[CORE.CurrentSheet].cleanEditSelection();CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(b)]&&(CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(b)][e]||
CORE.Sheets[CORE.CurrentSheet].cleanEditSelection())}else CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit&&(a.target.parentNode.id===CORE.DOM.Output.id?CORE.Sheets[CORE.CurrentSheet].cleanEditSelection():(CORE.Sheets[CORE.CurrentSheet].Selector.getSelection(),CORE.Sheets[CORE.CurrentSheet].getEditSelection(CORE.Sheets[CORE.CurrentSheet].Selector.Edit)));CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown=a.timeStamp;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed=!0}}};
CORE.Event.mouseUp=function(a){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed=!1;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.CellResize&&(CORE.Sheets[CORE.CurrentSheet].updateWidth(),CORE.Sheets[CORE.CurrentSheet].generateMenu(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection(),CORE.Sheets[CORE.CurrentSheet].Input.Mouse.CellResize=!1)};
CORE.Event.mouseWipe=function(a){if(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.x!==a.pageX||CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.y!==a.pageY){if(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed&&a.target.parentNode.id===CORE.DOM.Output.id){var b=a.target.getAttribute("name"),c=CORE.$.alphaToNumber(b.match(CORE.REGEX.numbers).join("")),b=~~b.match(CORE.REGEX.letters).join(""),e=CORE.$.numberToAlpha(c)+b,d=CORE.$.numberToAlpha(c);if(CORE.$.numberToAlpha(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Letter)+
CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Number===e)return;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.startedMouseWipe&&(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First={Letter:CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell.Letter,Number:CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell.Number});CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last={Letter:c,Number:b};CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number&&
CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Number&&(CORE.Cells.Used[CORE.CurrentSheet][d]&&!CORE.Cells.Used[CORE.CurrentSheet][d][d+b]&&CORE.Cells.Used[CORE.CurrentSheet][d][e]&&CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection());CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(c)]&&CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(c)][e]&&CORE.Sheets[CORE.CurrentSheet].cleanEditSelection()}CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.x=
a.pageX;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.y=a.pageY;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.startedMouseWipe=!0}};
CORE.Event.scroll=function(a){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll||(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll=a.timeStamp);if(!CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg){var b=Math.floor(CORE.Sheets[CORE.CurrentSheet].Settings.y*(CORE.SystemSpeed-.5)),c=0,e=0;if(a.target.parentNode.id===CORE.DOM.Output.id){a.wheelDelta?(0<-120*a.wheelDelta&&(c=1),e=Math.floor(a.wheelDelta/10),e=0>=e?-1*e:e):0<a.deltaY?(c=1,e=Math.floor(a.deltaY),e=0>=e?-1*e:e):0<-120*
a.detail?(c=0,e=Math.floor(10*a.detail),e=0>=e?-1*e:e):0>-120*a.detail?(c=1,e=Math.floor(10*a.detail),e=0>=e?-1*e:e):c=0;c=c?"down":"up";if(0<CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll){var d=a.timeStamp-CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll,f=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells.length;1E3<=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells.length?CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed?CORE.Settings.Scroll.Vertical=b+100*Math.ceil(Math.log(f+
1)/Math.LN10):d/CORE.SystemSpeed<=b*Math.ceil(Math.log(f+1)/Math.LN10)/CORE.SystemSpeed?CORE.Settings.Scroll.Vertical=Math.floor(e):CORE.Settings.Scroll.Vertical=1E4<=f?Math.floor(e):CORE.Settings.Scroll.OriginalVertical:CORE.Settings.Scroll.Vertical=75>=d?Math.floor(e):CORE.Settings.Scroll.OriginalVertical}CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!0;"down"===c?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+=CORE.Settings.Scroll.Vertical,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=
CORE.Settings.Scroll.Vertical,(75<d||d>2*b)&&CORE.Event.animateMouseDown(),CORE.Sheets[CORE.CurrentSheet].updateHeight("down",CORE.Settings.Scroll.Vertical)):"up"===c&&(0>=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-CORE.Settings.Scroll.Vertical?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=0,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=0,CORE.Sheets[CORE.CurrentSheet].updateHeight("default",CORE.Settings.Scroll.Vertical),CORE.Event.animateMouseUpMaximum()):0<=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-
CORE.Settings.Scroll.Vertical&&(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-=CORE.Settings.Scroll.Vertical,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=CORE.Settings.Scroll.Vertical,CORE.Sheets[CORE.CurrentSheet].updateHeight("up",CORE.Settings.Scroll.Vertical),(75<d||d>2*b)&&CORE.Event.animateMouseUp()));c&&(CORE.Connector.connected&&CORE.Connector.action("scrolling",{direction:c,amount:CORE.Settings.Scroll.Vertical,position:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY}),CORE.Sheets[CORE.CurrentSheet].updateMenu(),
CORE.Sheets[CORE.CurrentSheet].Selector.getSelection(),CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.x=Math.random(),CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.y=Math.random(),CORE.Event.mouseWipe(a));CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll=a.timeStamp}}};
CORE.Event.keyPress=function(a){CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress||(CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=a.timeStamp);if(0<CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress){var b=a.timeStamp-CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress;if(b&&100>=b)return}if(!CORE.Sheets[CORE.CurrentSheet].Input.Mouse.LiveCellEdit&&123!==a.keyCode)if(13===a.keyCode&&(a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null,CORE.Event.pressedEnter(a.keyCode)),
16===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Shift=!0;else if(17===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg=!0;else if(9===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Tab=!0,CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null,CORE.Event.navigateTo("right",1);else if(33===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null,CORE.Sheets[CORE.CurrentSheet].Selector.jump("up",
CORE.Sheets[CORE.CurrentSheet].Settings.y);else if(34===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null,CORE.Sheets[CORE.CurrentSheet].Selector.jump("down",CORE.Sheets[CORE.CurrentSheet].Settings.y);else{switch(a.keyCode){case 38:if(CORE.Event.inEditMode())return;--CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY;CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=1;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null;CORE.Sheets[CORE.CurrentSheet].Selector.selectCellByKeyPress();
CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=a.timeStamp-100;return;case 40:if(CORE.Event.inEditMode())return;CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+=1;CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=1;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null;CORE.Sheets[CORE.CurrentSheet].Selector.selectCellByKeyPress();CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=a.timeStamp-100;return;case 37:if(CORE.Event.inEditMode())return;CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX-=
CORE.Settings.Scroll.Horizontal;CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollX=CORE.Settings.Scroll.Horizontal;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null;CORE.Sheets[CORE.CurrentSheet].Selector.selectCellByKeyPress();CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=a.timeStamp-100;CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!1;return;case 39:if(CORE.Event.inEditMode())return;CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+=CORE.Settings.Scroll.Horizontal;
CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollX=CORE.Settings.Scroll.Horizontal;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null;CORE.Sheets[CORE.CurrentSheet].Selector.selectCellByKeyPress();CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=a.timeStamp-100;CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!1;return}CORE.Event.sniffCellInput(a.keyCode)}};
CORE.Event.keyUp=function(a){16===a.keyCode&&(a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Shift=!1);17===a.keyCode&&(a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg=!1);9===a.keyCode&&(a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Tab=!1)};
CORE.Event.inEditMode=function(){if(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit&&CORE.Sheets[CORE.CurrentSheet].Selector.Edit){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.numbers).join("");if(CORE.Cells.Used[CORE.CurrentSheet][a]&&CORE.Cells.Used[CORE.CurrentSheet][a][CORE.Sheets[CORE.CurrentSheet].Selector.Edit])return!0}return!1};CORE.Event.pressedArrowKey=function(a){return 0<=[37,38,39,40].indexOf(a)?!0:!1};
CORE.Event.pressedEnter=function(a){return 13===a?(CORE.Event.inEditMode()&&(CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()),!0):!1};
CORE.Event.sniffCellInput=function(a){var b=0;if(CORE.Event.inEditMode()){CORE.Sheets[CORE.CurrentSheet].Selector.cellFocusSwitch=!1;var c=CORE.$.alphaToNumber(CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.numbers).join("")),b=~~CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.letters).join(""),b=CORE.$.getCell({letter:c,number:b});0<=b&&(CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(c)][CORE.Sheets[CORE.CurrentSheet].Selector.Edit].Content=CORE.DOM.CellInput.value)}CORE.Event.pressedEnter(a)?
CORE.Event.navigateTo("down",1):(CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].getEditSelection({letter:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,number:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number}),this.processCellContent())};
CORE.Event.isFormula=function(){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Edit;if(CORE.Event.inEditMode()){var b=a.match(CORE.REGEX.numbers).join(""),c=CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Cells.Used[CORE.CurrentSheet][b][a].Content?CORE.Cells.Used[CORE.CurrentSheet][b][a].Content:void 0;void 0!==c&&null!==c&&c.length&&("="===c[0]?CORE.Cells.Used[CORE.CurrentSheet][b][a].Formula=c:(CORE.Cells.Used[CORE.CurrentSheet][b][a].Formula&&CORE.Cells.Used[CORE.CurrentSheet][b][a].Formula.length&&
(CORE.Cells.Used[CORE.CurrentSheet][b][a].Formula=null),CORE.Cells.Used[CORE.CurrentSheet][b][a].Content&&CORE.Cells.Used[CORE.CurrentSheet][b][a].Content.length&&CORE.updateCell(a,CORE.Cells.Used[CORE.CurrentSheet][b][a].Content)))}};
CORE.Event.processCellContent=function(){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Edit,b=null,c=0,e=a.match(CORE.REGEX.numbers).join(""),d=a.match(CORE.REGEX.letters).join("");CORE.DOM.CellInput.focus();setTimeout(function(){CORE.$.registerCell({letter:e,number:d});c=CORE.$.getCell({letter:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,number:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number});0<=c&&(b=CORE.DOM.Output.children[c]);CORE.Cells.Used[CORE.CurrentSheet][e][a]?
CORE.Cells.Used[CORE.CurrentSheet][e][a].Content=CORE.DOM.CellInput.value:CORE.registerCell(a);b&&(b.innerHTML=CORE.Cells.Used[CORE.CurrentSheet][e][a].Content);CORE.Event.isFormula();CORE.Cells.Used[CORE.CurrentSheet][e][a]&&CORE.Cells.Used[CORE.CurrentSheet][e][a].Content&&CORE.Sheets[CORE.CurrentSheet].Selector.cellFocusSwitch&&CORE.Sheets[CORE.CurrentSheet].goToEndOfCellText();CORE.Sheets[CORE.CurrentSheet].Selector.cellFocusSwitch=!0;CORE.DOM.CellInput.focus();CORE.Connector.connected&&CORE.Connector.action("updateCell",
{cell:a,value:CORE.DOM.CellInput.value})},1)};CORE.Event.navigateTo=function(a,b){CORE.eval();CORE.Sheets[CORE.CurrentSheet].getEditSelection({letter:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,number:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number});CORE.Sheets[CORE.CurrentSheet].cleanEditSelection();CORE.Sheets[CORE.CurrentSheet].Selector.moveSelection(a,b);CORE.DOM.CellInput.blur()};CORE.Speedy=function(){};CORE.Speedy.prototype=CORE.Speedy;
CORE.Speedy.prototype.runTest=function(a){if(localStorage.SystemSpeed)CORE.SystemSpeed=~~localStorage.SystemSpeed;else{for(var b=null,b=performance.now(),c=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells,e=0;1E4>e;++e)c.push({letter:1,number:e});for(c=1;50>=c;++c)CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=c,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=c,CORE.Sheets[CORE.CurrentSheet].updateHeight("down",1),CORE.Sheets[CORE.CurrentSheet].updateMenu(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();
b=performance.now()-b;b=200>b?1:400>b?1:500>b?2:500<b?2:600<b?3:700<b?4:5;localStorage.setItem("SystemSpeed",b);CORE.SystemSpeed=b}a()};CORE.Sheets=function(){};CORE.Sheets.prototype=CORE.Sheets;
CORE.Sheets.prototype.addSheet=function(a){CORE.SheetCount++;var b=CORE.SheetCount;if(Object.keys(CORE.Sheets).length){if(CORE.Sheets["Sheet"+b])for(;b++&&(CORE.Sheets["Sheet"+b]||!(b>CORE.SheetCount)););}else b=1;CORE.CurrentSheet=a&&a.length?a:"Sheet"+b;CORE.Cells.Used[CORE.CurrentSheet]||(CORE.Cells.Used[CORE.CurrentSheet]={});CORE.Sheets[CORE.CurrentSheet]=new CORE.Grid;CORE.Sheets[CORE.CurrentSheet].Selector=new CORE.Selector;a=document.createElement("button");a.className="mui-btn mui-btn-default mui-btn-mini slideUp";
a.setAttribute("style","color:#fff;background-color:rgba(130, 177, 255, 0.8);");a.setAttribute("name",CORE.CurrentSheet);a.innerHTML=CORE.CurrentSheet;b=document.createElement("button");b.className="mui-btn mui-btn-floating mui-btn-floating-mini";b.innerHTML="-";b.className="closeButton";a.appendChild(b);a.addEventListener("click",function(a){var b=a.target.getAttribute("name");b&&b.length?(CORE.Sheets.changeSheet(b),CORE.Event.resize(),CORE.DOM.Output.classList.add("fadeIn"),CORE.Sheets.setActiveSheet(b),
setTimeout(function(){CORE.DOM.Output.classList.remove("fadeIn")},275)):(b=a.target.parentNode.getAttribute("name"))&&CORE.Sheets.deleteSheet(b)});CORE.DOM.Sheets.appendChild(a);CORE.Sheets.changeSheet(CORE.CurrentSheet);CORE.Event.resize();CORE.Sheets.setActiveSheet(CORE.CurrentSheet);CORE.DOM.Output.classList.add("pullDown");setTimeout(function(){CORE.DOM.Output.classList.remove("pullDown")},275)};
CORE.Sheets.prototype.deleteSheet=function(a){if(CORE.Sheets[a]&&1<Object.keys(CORE.Sheets).length&&confirm("Do you really want to delete "+a+"?")){if(a===CORE.CurrentSheet){var b=void 0,c;for(c in CORE.Sheets)c===a&&(b?(this.changeSheet(b),delete CORE.Sheets[a],this.setActiveSheet(b)):(delete CORE.Sheets[c],b=Object.keys(CORE.Sheets)[0],this.changeSheet(b),this.setActiveSheet(c))),b=c;CORE.Event.resize()}else delete CORE.Sheets[a],this.setActiveSheet(CORE.CurrentSheet);CORE.Connector.connected&&
CORE.Connector.action("deleteSheet",{sheet:a})}};CORE.Sheets.prototype.changeSheet=function(a){CORE.CurrentSheet=a;CORE.Connector.connected&&CORE.Connector.action("changeSheet",{sheet:a})};
CORE.Sheets.prototype.setActiveSheet=function(a){for(var b=null,c=0;c<CORE.DOM.Sheets.children.length;++c)CORE.DOM.Sheets.children[c].classList.remove("activeSheet"),b=CORE.DOM.Sheets.children[c].getAttribute("name"),CORE.Sheets[b]||CORE.DOM.Sheets.children[c].parentNode.removeChild(CORE.DOM.Sheets.children[c]),b===a&&CORE.DOM.Sheets.children[c].classList.add("activeSheet")};
CORE.Grid=function(){this.Settings={x:0,y:0,scrolledX:0,scrolledY:0,keyScrolledX:0,keyScrolledY:0,cellResizedX:0,cellResizedY:0,lastScrollX:0,lastScrollY:0};this.CellTemplate={Width:100,Height:25};this.mouseScrollDirection={oldX:0,oldY:0,directionX:null,directionY:null};this.customCellSizes={alphabetical:{},numeric:{},array:[]};this.cellArray=[];this.mouseMode=CORE.Settings.Mobile?"click":"mouseover";this.Templates={Cell:{element:"div","class":"row",style:{height:this.CellTemplate.Height,width:this.CellTemplate.Width}},
Menu:{Alphabetical:{element:"div","class":"row cell_dark_alpha",style:{height:this.CellTemplate.Height,width:this.CellTemplate.Width}},Numeric:{element:"div","class":"row cell_dark_number",style:{height:this.CellTemplate.Height,width:this.CellTemplate.Width/2}}}};this.Input={Mouse:{Pressed:!1,lastMousePosition:{x:0,y:0},CellResize:!1,Edit:!1,LiveCellEdit:!1,lastMouseDown:0,lastMouseDownCell:{Letter:1,Number:1},lastMouseScroll:(new Date).getTime(),startedMouseWipe:!1},Keyboard:{Shift:!1,Strg:!1,Tab:!1,
lastKeyPress:0},lastAction:{scrollY:!1,scrollX:!1}};this.calculateGrid()};CORE.Grid.prototype=CORE.Grid;CORE.Grid.prototype.constructor=CORE.Grid;CORE.Grid.prototype.calculateGrid=function(){this.Settings.x=Math.ceil(-(CORE.Settings.Width/this.CellTemplate.Width));this.Settings.y=Math.ceil(-(CORE.Settings.Height/this.CellTemplate.Height));this.Settings.x=~this.Settings.x+2;this.Settings.y=~this.Settings.y+1-2};
CORE.Grid.prototype.addCellListeners=function(){for(var a=0;a<CORE.DOM.Output.children.length;++a)CORE.DOM.Output.children[a].addEventListener(this.mouseMode,function(a){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit||(CORE.DOM.CurrentCell.innerHTML=a.target.getAttribute("name"))})};
CORE.Grid.prototype.generateCells=function(){var a=1,b=0,c=null,e=0,d=0,f,g=0,h=null,k=this.Templates.Cell.style.width,m=this.Templates.Cell.style.height,l="";this.cellArray=Array(this.Settings.x*this.Settings.y);this.generateMenu();for(var n=0;n<this.Settings.x;++n)for(var p=0;p<this.Settings.y;++p)f=this.CellTemplate.Width*n,g=this.CellTemplate.Height*p,e+=1,b+=1,e<this.Settings.y?c=CORE.$.numberToAlpha(a):1===e%this.Settings.y&&(a+=1,c=CORE.$.numberToAlpha(a)),h="height: "+m+"px; width: "+k+"px;",
h+=" left:"+f+"px; top: "+g+"px;",l+="<"+this.Templates.Cell.element+' name="'+c+b+'" id="'+e+'" class="'+this.Templates.Cell["class"]+'" style="'+h+'">',CORE.Cells.Used[CORE.CurrentSheet][c]&&CORE.Cells.Used[CORE.CurrentSheet][c][c+b]&&(l+=CORE.Cells.Used[CORE.CurrentSheet][c][c+b].Content),l+="</"+this.Templates.Cell.element+">",0===e%this.Settings.y&&(b=0),this.cellArray[d]={id:e,x:n,y:p,origWidth:k,origHeight:m,origTop:g,origLeft:f},d++;CORE.DOM.Output.innerHTML=l;this.cacheDOM();this.addCellListeners();
CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit&&this.getEditSelection(CORE.Sheets[CORE.CurrentSheet].Selector.Edit)};CORE.Grid.prototype.cacheDOM=function(){var a=CORE.DOM.Output.children,b=CORE.DOM.Output.children.length;CORE.DOM.Cache={};CORE.DOM.CacheArray=Array(b);for(var c=0;c<b;++c)CORE.DOM.Cache[c]=a[c],CORE.DOM.CacheArray[c]=a[c]};
CORE.Grid.prototype.generateMenu=function(){var a=0,b=0,c=this.Settings.x,e=this.Settings.y,c=c+1,e=e+1;CORE.DOM.HorizontalMenu.innerHTML=CORE.DOM.VerticalMenu.innerHTML="";for(var d=0;d<c;++d)for(var f=0;f<e;++f)0<d&&d!==a&&(a=d,this.generateMenuNode(CORE.$.numberToAlpha(a+this.Settings.scrolledX),CORE.DOM.HorizontalMenu,d,f,"alpha")),0<f&&f>b&&(b=f,this.generateMenuNode(b+this.Settings.scrolledY,CORE.DOM.VerticalMenu,d,f,"numeric"))};
CORE.Grid.prototype.generateMenuNode=function(a,b,c,e,d){var f=0,g="numeric"===d?this.Templates.Menu.Numeric:this.Templates.Menu.Alphabetical,h=g.style.width,k=g.style.height,m=null;c*=this.CellTemplate.Width;f=this.CellTemplate.Height*e;"alpha"===d&&this.customCellSizes.alphabetical[a]&&(h+=this.customCellSizes.alphabetical[a].Width);if("alpha"===d)for(var l in this.customCellSizes.alphabetical)CORE.$.alphaToNumber(a)>CORE.$.alphaToNumber(l)&&(c+=this.customCellSizes.alphabetical[l].Width),this.Settings.scrolledX&&
this.Settings.scrolledX>=CORE.$.alphaToNumber(l)&&(c-=this.customCellSizes.alphabetical[l].Width);"numeric"===d&&this.customCellSizes.numeric[a]&&(k+=this.customCellSizes.numeric[a].Height);if("numeric"===d)for(l in this.customCellSizes.numeric)a>l&&(f+=this.customCellSizes.numeric[l].Height),this.Settings.scrolledY&&this.Settings.scrolledY>=l&&(f-=this.customCellSizes.numeric[l].Height);"numeric"===d?m="height: "+k+"px; width: "+h+"px;"+(" left:"+c+"px; top: "+f+"px;"):"alpha"===d&&(m="height: "+
k+"px; width: "+(h+1)+"px;"+(" left:"+c+"px; top: "+f+"px;"));"numeric"===d&&(m+=" line-height: "+(k-8)+"px;");e=null;e="alpha"===d?this.createAlphabeticalMenuCell(a,m,g):this.createNumericMenuCell(a,m,g);b.appendChild(e)};
CORE.Grid.prototype.createAlphabeticalMenuCell=function(a,b,c){var e=this,d=document.createElement(c.element);d.className=c["class"];d.setAttribute("clicked",0);d.setAttribute("style",b);d.setAttribute("timestamp",(new Date).getTime());d.innerHTML=a;d.addEventListener("mousedown",function(a){150>=(new Date).getTime()-parseInt(this.getAttribute("timestamp"))?CORE.Sheets[CORE.CurrentSheet].Selector.masterSelect(a.target.innerHTML):this.setAttribute("timestamp",a.timeStamp);this.setAttribute("clicked",
1);CORE.Sheets[CORE.CurrentSheet].Input.Mouse.CellResize=!0});d.addEventListener("mouseup",function(a){this.setAttribute("clicked",0);CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!1;this.setAttribute("timestamp",a.timeStamp)});d.addEventListener("mouseout",function(a){this.setAttribute("clicked",0)});d.addEventListener("mousemove",function(a){var b=a.pageX-this.offsetLeft,c=a.pageY-this.offsetTop;e.mouseScrollDirection.directionX=a.pageX<e.mouseScrollDirection.oldX?"left":a.pageX>e.mouseScrollDirection.oldX?
"right":null;e.mouseScrollDirection.oldX=a.pageX;-35<=b+c?(a.target.style.cursor="e-resize","1"===a.target.getAttribute("clicked")&&(b=a.target.innerHTML,e.customCellSizes.alphabetical[b]||(e.customCellSizes.alphabetical[b]={Width:0,Height:0}),"right"===e.mouseScrollDirection.directionX?(a.target.style.width=parseInt(a.target.style.width)+2+"px",e.customCellSizes.alphabetical[b].Width+=2,e.Settings.cellResizedX+=2):"left"===e.mouseScrollDirection.directionX&&(parseInt(a.target.style.width)>e.CellTemplate.Width?
(a.target.style.width=parseInt(a.target.style.width)-2+"px",e.customCellSizes.alphabetical[b].Width-=2,e.Settings.cellResizedX-=2):(a.target.style.width=e.CellTemplate.Width+"px",e.customCellSizes.alphabetical[b].Width=0)))):a.target.style.cursor="pointer"});return d};
CORE.Grid.prototype.createNumericMenuCell=function(a,b,c){var e=this,d=document.createElement(c.element);d.className=c["class"];d.setAttribute("clicked",0);d.setAttribute("style",b);d.setAttribute("timestamp",(new Date).getTime());d.innerHTML=a;d.addEventListener("mousedown",function(a){150>=(new Date).getTime()-parseInt(this.getAttribute("timestamp"))?CORE.Sheets[CORE.CurrentSheet].Selector.masterSelect(parseInt(a.target.innerHTML)):this.setAttribute("timestamp",a.timeStamp);this.setAttribute("clicked",
1);CORE.Sheets[CORE.CurrentSheet].Input.Mouse.CellResize=!0});d.addEventListener("mouseup",function(a){this.setAttribute("clicked",0)});d.addEventListener("mouseout",function(a){this.setAttribute("clicked",0)});d.addEventListener("mousemove",function(a){var b=a.pageX-this.offsetLeft,c=a.pageY-this.offsetTop;e.mouseScrollDirection.directionY=a.pageY<e.mouseScrollDirection.oldY?"up":a.pageY>e.mouseScrollDirection.oldY?"down":null;e.mouseScrollDirection.oldY=a.pageY;-35<=b+c?(a.target.style.cursor="n-resize",
"1"===a.target.getAttribute("clicked")&&(b=a.target.innerHTML,e.customCellSizes.numeric[b]||(e.customCellSizes.numeric[b]={Width:0,Height:0},e.customCellSizes.array.push(~~b)),"down"===e.mouseScrollDirection.directionY?(a.target.style.height=parseInt(a.target.style.height)+2+"px",e.customCellSizes.numeric[b].Height+=2,e.Settings.cellResizedY+=2):"up"===e.mouseScrollDirection.directionY&&(parseInt(a.target.style.height)>e.CellTemplate.Height?(a.target.style.height=parseInt(a.target.style.height)-2+
"px",e.customCellSizes.numeric[b].Height-=2,e.Settings.cellResizedY-=2):(a.target.style.height=e.CellTemplate.Height+"px",e.customCellSizes.numeric[b].Height=0)))):a.target.style.cursor="pointer"});return d};CORE.Grid.prototype.updateMenu=function(){this.Settings.cellResizedX||this.Settings.cellResizedY?this.generateMenu():this.updateMenuNoResizement()};
CORE.Grid.prototype.updateMenuNoResizement=function(){for(var a=0;a<this.Settings.y;++a)CORE.DOM.VerticalMenu.children[a].innerHTML=a+this.Settings.scrolledY+1;for(a=0;a<this.Settings.x;++a)CORE.DOM.HorizontalMenu.children[a].innerHTML=CORE.$.numberToAlpha(a+this.Settings.scrolledX+1)};
CORE.Grid.prototype.updateHeight=function(a,b){var c=this.Settings.x,e=this.Settings.y,d=this.Settings.y,f=0,g=0,h=null,g=0,h=0>=this.Settings.scrolledX?CORE.DOM.Output.children[0].getAttribute("name").match(CORE.REGEX.numbers).join(""):CORE.$.numberToAlpha(this.Settings.scrolledX+1);this.Settings.scrolledY=0>this.Settings.scrolledY?0:CORE.$.isSafeInteger(this.Settings.scrolledY);for(var k=0;k<c*e;++k)"down"===a?(g=this.Settings.scrolledY-b+1,g=k+b-f+g):"up"===a?(g=this.Settings.scrolledY+b+1,g=k-
b-f+g):(g=1,g=k+this.Settings.scrolledY-f+g),CORE.DOM.Output.children[k].setAttribute("name",h+g),this.removeCellStyling(k),CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[h]?this.updateCellMasterStyling(h,k):CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[g]&&this.updateCellMasterStyling(g,k),CORE.Cells.Used[CORE.CurrentSheet][h]&&CORE.Cells.Used[CORE.CurrentSheet][h][h+g]&&this.updateCellStyling(h,h+g,k),CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY||this.resizeHorizontal(h,
k),this.resizeVertical(g,k),0===(k+1)%d&&(h=CORE.$.numberToAlpha(CORE.$.alphaToNumber(h)+1),f=k+1)};
CORE.Grid.prototype.updateWidth=function(a){for(var b=0,c=this.Settings.x,e=this.Settings.y,d=0,f=0,g=null,c=c+1,e=e+1,h=0;h<c;++h)for(var k=0;k<e;++k){if(0<h&&h!==b)for(var b=h,m=0;m<e;++m)f=m+d-b-e,CORE.DOM.Output.children[f]&&CORE.DOM.Output.children[f].setAttribute("name",g+f);d+=1;g="right"===a||"left"===a?0===b?CORE.$.numberToAlpha(this.Settings.scrolledX+1):CORE.$.numberToAlpha(b+(this.Settings.scrolledX+1)):0===this.Settings.scrolledX?CORE.$.numberToAlpha(this.Settings.scrolledX+1):1===this.Settings.scrolledX?
CORE.$.numberToAlpha(this.Settings.scrolledX):CORE.$.numberToAlpha(this.Settings.scrolledX+1);this.Settings.scrolledX=CORE.$.isSafeInteger(this.Settings.scrolledX)}this.updateHeight("default",CORE.Settings.Scroll.Vertical)};
CORE.Grid.prototype.updateCellStyling=function(a,b,c){CORE.Cells.Used[CORE.CurrentSheet][a]&&CORE.Cells.Used[CORE.CurrentSheet][a][b]&&(void 0!==CORE.Cells.Used[CORE.CurrentSheet][a][b].Content&&null!==CORE.Cells.Used[CORE.CurrentSheet][a][b].Content&&(CORE.DOM.Cache[c].innerHTML=CORE.Cells.Used[CORE.CurrentSheet][a][b].Content),CORE.Cells.Used[CORE.CurrentSheet][a][b].Font&&(CORE.DOM.Cache[c].style.fontFamily=CORE.Cells.Used[CORE.CurrentSheet][a][b].Font),CORE.Cells.Used[CORE.CurrentSheet][a][b].FontSize&&
(CORE.DOM.Cache[c].style.fontSize=CORE.Cells.Used[CORE.CurrentSheet][a][b].FontSize+"px"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Color&&(CORE.DOM.Cache[c].style.color=CORE.Cells.Used[CORE.CurrentSheet][a][b].Color),CORE.Cells.Used[CORE.CurrentSheet][a][b].FontBold&&(CORE.DOM.Cache[c].style.fontWeight="bold"),CORE.Cells.Used[CORE.CurrentSheet][a][b].FontItalic&&(CORE.DOM.Cache[c].style.fontStyle="italic"),CORE.Cells.Used[CORE.CurrentSheet][a][b].FontUnderlined&&(CORE.DOM.Cache[c].style.textDecoration=
"underline"),CORE.Cells.Used[CORE.CurrentSheet][a][b].BackgroundColor&&(CORE.DOM.Cache[c].style.background=CORE.Cells.Used[CORE.CurrentSheet][a][b].BackgroundColor),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.used&&(CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.left&&(CORE.DOM.Cache[c].style.borderLeft="2px solid black"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.right&&(CORE.DOM.Cache[c].style.borderRight="2px solid black"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.top&&(CORE.DOM.Cache[c].style.borderTop=
"2px solid black"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.bottom&&(CORE.DOM.Cache[c].style.borderBottom="2px solid black"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.full&&(CORE.DOM.Cache[c].style.border="2px solid black")))};
CORE.Grid.prototype.updateCellMasterStyling=function(a,b){var c=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[a]||CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[a];c.Font&&(CORE.DOM.Cache[b].style.fontFamily=c.Font);c.FontSize&&(CORE.DOM.Cache[b].style.fontSize=c.FontSize+"px");c.Color&&(CORE.DOM.Cache[b].style.color=c.Color);c.FontBold&&(CORE.DOM.Cache[b].style.fontWeight="bold");c.FontItalic&&(CORE.DOM.Cache[b].style.fontStyle="italic");c.FontUnderlined&&(CORE.DOM.Cache[b].style.textDecoration=
"underline");c.BackgroundColor&&(CORE.DOM.Cache[b].style.background=c.BackgroundColor);c.Border&&c.Border.used&&(c.Border.left&&(CORE.DOM.Cache[b].style.borderLeft="2px solid black"),c.Border.right&&(CORE.DOM.Cache[b].style.borderRight="2px solid black"),c.Border.top&&(CORE.DOM.Cache[b].style.borderTop="2px solid black"),c.Border.bottom&&(CORE.DOM.Cache[b].style.borderBottom="2px solid black"),c.Border.full&&(CORE.DOM.Cache[b].style.border="2px solid black"))};
CORE.Grid.prototype.removeCellStyling=function(a){CORE.DOM.Cache[a].style.borderLeft="";CORE.DOM.Cache[a].style.borderRight="";CORE.DOM.Cache[a].style.borderTop="";CORE.DOM.Cache[a].style.borderBottom="";CORE.DOM.Cache[a].style.border="";CORE.DOM.Cache[a].style.fontFamily="";CORE.DOM.Cache[a].style.fontSize="12px";CORE.DOM.Cache[a].style.fontStyle="normal";CORE.DOM.Cache[a].style.fontWeight="normal";CORE.DOM.Cache[a].style.textDecoration="none";CORE.DOM.Cache[a].style.background="#fff";CORE.DOM.Cache[a].style.color=
"#000";CORE.DOM.Cache[a].innerHTML=""};
CORE.Grid.prototype.resizeHorizontal=function(a,b){var c=this.customCellSizes.alphabetical,e=0,d=CORE.DOM.Cache[b].style;c[a]?(d.width=this.cellArray[b].origWidth+c[a].Width+"px",d.left=this.cellArray[b].origLeft+"px"):d.width=this.cellArray[b].origWidth+"px";var f=CORE.$.alphaToNumber(a),g;for(g in c){var h=CORE.$.alphaToNumber(g);f>h&&(e+=c[g].Width,d.left=this.cellArray[b].origLeft+e+"px");0<this.Settings.scrolledX&&h<=this.Settings.scrolledX&&(d.left=this.cellArray[b].origLeft+"px");f>=h&&this.Settings.scrolledX>=
h&&(e-=c[g].Width,d.left=this.cellArray[b].origLeft+e+"px")}};
CORE.Grid.prototype.resizeVertical=function(a,b){var c=this.customCellSizes.numeric,e=0,d=CORE.DOM.Cache[b].style,f=this.cellArray[b].origHeight,g=this.cellArray[b].origTop;c[a]?(d.height=f+c[a].Height+"px",d.top=g+"px"):d.height=f+"px";if(this.verticalInView(a))for(var h in c)a>h&&(e+=c[h].Height),d.top=g+e+"px",0<this.Settings.scrolledY&&h<=this.Settings.scrolledY&&(d.top=g+"px"),a>=h&&this.Settings.scrolledY>=h&&(e-=c[h].Height,d.top=g+e+"px")};
CORE.Grid.prototype.verticalInView=function(a){a=this.customCellSizes.array.length;for(var b=0;b<a;++b)if(this.customCellSizes.array[b]<=this.Settings.scrolledY+(this.Settings.y+this.Settings.lastScrollY)&&this.customCellSizes.array[b]>=this.Settings.scrolledY-this.Settings.lastScrollY)return!0;return!1};
CORE.Grid.prototype.Cell=function(){this.FontSize=this.Font=this.Content=this.Formula=this.BackgroundColor=this.Color=null;this.FontUnderlined=this.FontItalic=this.FontBold=!1;this.Border={top:!1,bottom:!1,left:!1,right:!1,full:!1,style:!1,color:null,used:!1}};CORE.Grid.prototype.LiveCell=function(){this.Url="";this.RefreshTime=2500;this.Active=!1;this.Data=""};CORE.Injector=function(){};CORE.Injector.prototype=CORE.Injector;CORE.Injector.prototype.constructor=CORE.Injector;
CORE.Injector.prototype.getAlphaUsedCells=function(a){var b=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First,c=CORE.Cells.Used[CORE.CurrentSheet],e,d,f=[],g;for(g in c)if(c[g]&&CORE.$.alphaToNumber(g)>=b.Letter){for(var h in c[g]){switch(a){case "insert":e=CORE.$.numberToAlpha(CORE.$.alphaToNumber(h.match(CORE.REGEX.numbers).join(""))+1);break;case "delete":e=CORE.$.numberToAlpha(CORE.$.alphaToNumber(h.match(CORE.REGEX.numbers).join(""))-1)}d=~~h.match(CORE.REGEX.letters).join("");c[g][e+d]=
c[g][h];delete c[g][h]}f.push({old:g,"new":e})}return f};CORE.Injector.prototype.getNumericUsedCells=function(a){var b=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First,c=CORE.Cells.Used[CORE.CurrentSheet],e,d,f=null,g=[],h;for(h in c)for(var k in c[h])if(f=parseInt(k.match(CORE.REGEX.letters).join("")),e=k.match(CORE.REGEX.numbers).join(""),f>=b.Number){switch(a){case "insert":d=f+1;break;case "delete":d=f-1}g.push({old:f,"new":d,letter:e})}return g};
CORE.Injector.prototype.getAlphaMasterColumns=function(a){var b=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First,c=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns,e=[],d;for(d in c)if(c[d]&&CORE.$.alphaToNumber(d)>=b.Letter)switch(a){case "insert":e.push({old:d,"new":CORE.$.numberToAlpha(CORE.$.alphaToNumber(d)+1)});break;case "delete":e.push({old:d,"new":CORE.$.numberToAlpha(CORE.$.alphaToNumber(d)-1)})}return e};
CORE.Injector.prototype.getNumericMasterRows=function(a){var b=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First,c=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows,e=[],d=0,f;for(f in c)if(d=parseInt(f),d>=b.Number)switch(a){case "insert":e.push({old:d,"new":d+1});break;case "delete":e.push({old:d,"new":d-1})}return e};
CORE.Injector.prototype.insertColumn=function(){for(var a=CORE.Cells.Used[CORE.CurrentSheet],b=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns,c=this.getAlphaMasterColumns("insert"),c=c.sortOn("old"),e=c.length;e--;){var d=c[e];b[d["new"]]=b[d.old];delete b[d.old]}c=this.getAlphaUsedCells("insert");c=c.sortOn("old");for(e=c.length;e--;)d=c[e],a[d["new"]]=a[d.old],delete a[d.old];CORE.Sheets[CORE.CurrentSheet].updateWidth("default");CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()};
CORE.Injector.prototype.insertRow=function(){for(var a=CORE.Cells.Used[CORE.CurrentSheet],b=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows,c=0,e=this.getNumericMasterRows("insert"),e=e.sortOn("old"),c=e.length;c--;){var d=e[c];b[d["new"]]=b[d.old];delete b[d.old]}e=this.getNumericUsedCells("insert");e=e.sortOn("old");for(c=e.length;c--;)d=e[c],b=d.letter+d.old,a[d.letter][d.letter+d["new"]]=a[d.letter][b],delete a[d.letter][b];CORE.Sheets[CORE.CurrentSheet].updateWidth("default");CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()};
CORE.Injector.prototype.deleteColumn=function(){for(var a=CORE.Cells.Used[CORE.CurrentSheet],b=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns,c=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First,e=this.getAlphaMasterColumns("delete"),e=e.sortOn("old"),d=0;d<e.length;++d){var f=e[d];CORE.$.alphaToNumber(f["new"])<c.Letter||(b[f["new"]]=b[f.old]);delete b[f.old]}e=this.getAlphaUsedCells("delete");e=e.sortOn("old");for(d=0;d<e.length;++d)f=e[d],CORE.$.alphaToNumber(f["new"])<c.Letter||
(a[f["new"]]=a[f.old]),delete a[f.old];CORE.Sheets[CORE.CurrentSheet].updateWidth("default");CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()};
CORE.Injector.prototype.deleteRow=function(){for(var a=CORE.Cells.Used[CORE.CurrentSheet],b=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows,c=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number,e=this.getNumericMasterRows("delete"),e=e.sortOn("old"),d=0;d<e.length;++d){var f=e[d];f["new"]<c||(b[f["new"]]=b[f.old]);delete b[f.old]}e=this.getNumericUsedCells("delete");e=e.sortOn("old");for(d=0;d<e.length;++d)f=e[d],f["new"]<c||(a[f.letter][f.letter+f["new"]]=a[f.letter][f.letter+
f.old]),delete a[f.letter][f.letter+f.old];CORE.Sheets[CORE.CurrentSheet].updateWidth("default");CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()};
CORE.Selector=function(){this.Selected={First:{Letter:null,Number:0},Last:{Letter:null,Number:0}};this.MenuSelection={Horizontal:0,Vertical:0};this.SelectedCells=[];this.parentSelectedCell={Letter:0,Number:0};this.cellFocusSwitch=!1;this.selectionMode=null;this.masterSelected={Current:null,Columns:{},Rows:{}};this.Selected={First:{Letter:0,Number:0},Last:{Letter:0,Number:0}};this.Select={Letter:0,Number:0};this.Edit=null};CORE.Selector.prototype=CORE.Selector;CORE.Selector.prototype.constructor=CORE.Selector;
CORE.Selector.prototype.addCellHoverEffect=function(){for(var a=0,b=0,a=0,c="",e=1>=this.SelectedCells.length?"single_row_hovered":"row_hovered",d=0;d<this.SelectedCells.length;++d)a=this.SelectedCells[d].letter,b=this.SelectedCells[d].number,c=CORE.$.numberToAlpha(a),1===this.SelectedCells.length&&CORE_UI.updateCellStyleMenu(this.SelectedCells[d]),a=CORE.$.getCell({letter:a,number:b}),0<=a&&CORE.DOM.CacheArray[a]&&(CORE.Cells.Used[CORE.CurrentSheet][c]&&CORE.Cells.Used[CORE.CurrentSheet][c][c+b]&&
null!==CORE.Cells.Used[CORE.CurrentSheet][c][c+b].BackgroundColor?CORE.DOM.CacheArray[a].style.background=CORE.Cells.Used[CORE.CurrentSheet][c][c+b].BackgroundColor.replace(")",", 0.55)").replace("rgb","rgba"):CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[c]&&null!==CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[c].BackgroundColor?CORE.DOM.CacheArray[a].style.background=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[c].BackgroundColor.replace(")",", 0.55)").replace("rgb",
"rgba"):CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b]&&null!==CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b].BackgroundColor?CORE.DOM.CacheArray[a].style.background=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b].BackgroundColor.replace(")",", 0.55)").replace("rgb","rgba"):CORE.DOM.CacheArray[a].classList.add(e));1<this.SelectedCells.length&&this.drawSelectionOuterBorder()};
CORE.Selector.prototype.deleteCellHoverEffect=function(){if(this.SelectedCells.length)for(var a=0,b=0,b="",c=1>=this.SelectedCells.length?"single_row_hovered":"row_hovered",e=0;e<CORE.DOM.CacheArray.length;++e)if(CORE.DOM.CacheArray[e].classList.remove(c,"border_top","border_bottom","border_left","border_right"),b=CORE.DOM.CacheArray[e].getAttribute("name"))a=b.match(CORE.REGEX.numbers).join(""),b=b.match(CORE.REGEX.letters).join(""),CORE.Cells.Used[CORE.CurrentSheet][a]&&CORE.Cells.Used[CORE.CurrentSheet][a][a+
b]?CORE.DOM.CacheArray[e].style.background=CORE.Cells.Used[CORE.CurrentSheet][a][a+b].BackgroundColor:CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[a]?CORE.DOM.CacheArray[e].style.background=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[a].BackgroundColor:CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b]&&(CORE.DOM.CacheArray[e].style.background=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b].BackgroundColor)};
CORE.Selector.prototype.selectCellByKeyPress=function(){var a=this.parentSelectedCell.Letter,b=this.parentSelectedCell.Number;0>=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+a?(a=a+CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX,1<=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX&&--CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX,CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+=1,CORE.Sheets[CORE.CurrentSheet].updateWidth("default"),
CORE.Sheets[CORE.CurrentSheet].updateMenu()):CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+a>=CORE.Sheets[CORE.CurrentSheet].Settings.x+1?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX+=1,a=CORE.Sheets[CORE.CurrentSheet].Settings.x+CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX,--CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX,CORE.Sheets[CORE.CurrentSheet].updateWidth("default"),CORE.Sheets[CORE.CurrentSheet].updateMenu()):a+=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+
CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX;0>=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+b?(b=1,CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+=1,1<=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY&&--CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY,CORE.Sheets[CORE.CurrentSheet].updateHeight("up",1),CORE.Sheets[CORE.CurrentSheet].updateMenu()):CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+b>=CORE.Sheets[CORE.CurrentSheet].Settings.y+1?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+=
1,b=CORE.Sheets[CORE.CurrentSheet].Settings.y+CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY,--CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY,CORE.Sheets[CORE.CurrentSheet].updateHeight("up",1),CORE.Sheets[CORE.CurrentSheet].updateMenu()):b+=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY;CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Shift?this.getSelectionByKeyPress(a,b):(this.select={Letter:a,Number:b},this.Selected.First={Letter:a,
Number:b},this.Selected.Last={Letter:a,Number:b},this.getSelection())};CORE.Selector.prototype.getSelectionByKeyPress=function(a,b){this.Selected.First=this.Select;this.Selected.Last={Letter:a,Number:b};this.getSelection()};
CORE.Selector.prototype.menuSelection=function(){var a=0,b=0;0<=["verticalPositive","horizontalPositive","horizontalNegativePositive"].indexOf(this.selectionMode)?(a=this.Selected.Last.Letter-1,b=this.Selected.Last.Number-1):0<=["verticalNegative","horizontalNegative","horizontalNegativeNegative"].indexOf(this.selectionMode)&&(a=this.Selected.First.Letter-1,b=this.Selected.First.Number-1);a-=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX;b-=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY;0<=
this.MenuSelection.Horizontal&&0<=this.MenuSelection.Vertical&&(CORE.DOM.HorizontalMenu.children[this.MenuSelection.Horizontal]&&(CORE.DOM.HorizontalMenu.children[this.MenuSelection.Horizontal].classList.add("cell_dark"),CORE.DOM.HorizontalMenu.children[this.MenuSelection.Horizontal].classList.remove("cell_bright")),CORE.DOM.VerticalMenu.children[this.MenuSelection.Vertical]&&(CORE.DOM.VerticalMenu.children[this.MenuSelection.Vertical].classList.add("cell_dark"),CORE.DOM.VerticalMenu.children[this.MenuSelection.Vertical].classList.remove("cell_bright")));
this.MenuSelection.Horizontal=a;this.MenuSelection.Vertical=b;CORE.DOM.HorizontalMenu.children[a]&&(CORE.DOM.HorizontalMenu.children[a].classList.add("cell_bright"),CORE.DOM.HorizontalMenu.children[a].classList.remove("cell_dark"));CORE.DOM.VerticalMenu.children[b]&&(CORE.DOM.VerticalMenu.children[b].classList.add("cell_bright"),CORE.DOM.VerticalMenu.children[b].classList.remove("cell_dark"))};
CORE.Selector.prototype.getSelection=function(){this.deleteCellHoverEffect();this.masterSelected.Current&&null!==this.masterSelected.Current&&(this.masterSelect(this.masterSelected.Current),"string"===typeof this.masterSelected.Current?(this.Selected.First={Letter:CORE.$.alphaToNumber(this.masterSelected.Current),Number:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY},this.Selected.Last={Letter:CORE.$.alphaToNumber(this.masterSelected.Current),Number:CORE.Sheets[CORE.CurrentSheet].Settings.y+(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+
1)}):"number"===typeof this.masterSelected.Current&&(this.Selected.First={Letter:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX,Number:this.masterSelected.Current},this.Selected.Last={Letter:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX+(CORE.Sheets[CORE.CurrentSheet].Settings.x+1),Number:this.masterSelected.Current}));var a=this.Selected.First,b=this.Selected.Last;this.Selected.First.Letter=a.Letter;this.Selected.First.Number=a.Number||1;this.Selected.Last.Letter=b.Letter;this.Selected.Last.Number=
b.Number||1;var a=CORE.$.alphaToNumber(this.Selected.Last.Letter)-CORE.$.alphaToNumber(this.Selected.First.Letter),b=this.Selected.Last.Number-this.Selected.First.Number+this.Selected.First.Number,c=null,e=this.Selected.First.Letter,d=this.Selected.First.Number,f=this.Selected.Last.Letter,g=this.Selected.Last.Number;this.SelectedCells=[];a=f-e;b=g>d?g-d+d:d;if(0===a&&0<=b)for(this.selectionMode="verticalPositive",this.Selected.First.Number>this.Selected.Last.Number&&(c=this.Selected.First.Number,
this.Selected.First.Number=this.Selected.Last.Number,this.Selected.Last.Number=c,this.selectionMode="verticalNegative"),c=0;c<b;++c)c+1>=d?this.SelectedCells.push({letter:e,number:c+1}):c+1>=g&&this.SelectedCells.push({letter:e,number:c+1});else if(0<a)if(d<=g)for(this.selectionMode="horizontalPositive",f=0;f<=a;++f)for(c=0;c<b;++c)c+1>=d&&this.SelectedCells.push({letter:e+f,number:c+1});else{this.Selected.First.Number=this.Selected.Last.Number;this.Selected.Last.Number=d;d=g;for(f=0;f<=a;++f)for(c=
0;c<b;++c)c+1>=d&&this.SelectedCells.push({letter:e+f,number:c+1});this.selectionMode="horizontalNegative"}else if(0>a)for(this.Selected.First.Letter>this.Selected.Last.Letter&&(c=this.Selected.First.Letter,this.Selected.First.Letter=this.Selected.Last.Letter,this.Selected.Last.Letter=c,this.selectionMode="horizontalNegativePositive"),this.Selected.First.Number>this.Selected.Last.Number&&(d=g,c=this.Selected.First.Number,this.Selected.First.Number=this.Selected.Last.Number,this.Selected.Last.Number=
c,this.selectionMode="horizontalNegativeNegative"),a=~a+1,e=f,g=d,f=0;f<=a;++f)for(c=0;c<b;++c)c+1>=g&&this.SelectedCells.push({letter:e+f,number:c+1});this.addCellHoverEffect();this.menuSelection();CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit||CORE.Sheets[CORE.CurrentSheet].cleanEditSelection()};
CORE.Selector.prototype.selectCell=function(a,b){this.deleteCellHoverEffect();this.Select={Letter:a,Number:b};this.Selected.First.Letter=a;this.Selected.First.Number=b;this.Selected.Last.Letter=a;this.Selected.Last.Number=b;this.SelectedCells=[{letter:a,number:b}];this.getSelection()};
CORE.Selector.prototype.moveSelection=function(a,b){var c=this.Selected.First.Letter,e=this.Selected.First.Number,d=c,f=e;switch(a){case "right":d=c+b;break;case "left":d=c-b;break;case "up":f=e-b;break;case "down":f=e+b}0>=d&&(d=1,this.parentSelectedCell.Letter=d);0>=f&&(f=1,this.parentSelectedCell.Number=f);CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY=0;"down"===a&&CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+e>=CORE.Sheets[CORE.CurrentSheet].Settings.y+
CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-1&&(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+=1,--CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY);"up"===a&&(CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+e<=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+1&&--CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY,CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+=1);CORE.Sheets[CORE.CurrentSheet].updateHeight("up",1);CORE.Sheets[CORE.CurrentSheet].generateMenu();this.selectCell(d,
f)};CORE.Selector.prototype.getOuterSelection=function(){for(var a=this.Selected.First,b=this.Selected.Last,c={top:[],bottom:[],left:[],right:[]},e=0;e<this.SelectedCells.length;++e)a.Letter===this.SelectedCells[e].letter&&c.left.push(this.SelectedCells[e]),b.Letter===this.SelectedCells[e].letter&&c.right.push(this.SelectedCells[e]),a.Number===this.SelectedCells[e].number&&c.top.push(this.SelectedCells[e]),b.Number===this.SelectedCells[e].number&&c.bottom.push(this.SelectedCells[e]);return c};
CORE.Selector.prototype.drawOuterBorder=function(){for(var a=this.getOuterSelection(),b="",b="",c=0;c<a.top.length;++c)b=CORE.$.numberToAlpha(a.top[c].letter),b=CORE.Cells.Used[CORE.CurrentSheet][b][b+a.top[c].number],b.Border.used=!0,b.Border.top=!0;for(c=0;c<a.bottom.length;++c)b=CORE.$.numberToAlpha(a.bottom[c].letter),b=CORE.Cells.Used[CORE.CurrentSheet][b][b+a.bottom[c].number],b.Border.used=!0,b.Border.bottom=!0;for(c=0;c<a.left.length;++c)b=CORE.$.numberToAlpha(a.left[c].letter),b=CORE.Cells.Used[CORE.CurrentSheet][b][b+
a.left[c].number],b.Border.used=!0,b.Border.left=!0;for(c=0;c<a.right.length;++c)b=CORE.$.numberToAlpha(a.right[c].letter),b=CORE.Cells.Used[CORE.CurrentSheet][b][b+a.right[c].number],b.Border.used=!0,b.Border.right=!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default")};
CORE.Selector.prototype.drawSelectionOuterBorder=function(){for(var a=this.getOuterSelection(),b=0,c=0;c<a.top.length;++c)(b=CORE.$.getCell(a.top[c]))&&CORE.DOM.CacheArray[b].classList.add("border_top");for(c=0;c<a.bottom.length;++c)(b=CORE.$.getCell(a.bottom[c]))&&CORE.DOM.CacheArray[b].classList.add("border_bottom");for(c=0;c<a.left.length;++c)(b=CORE.$.getCell(a.left[c]))&&CORE.DOM.CacheArray[b].classList.add("border_left");for(c=0;c<a.right.length;++c)(b=CORE.$.getCell(a.right[c]))&&CORE.DOM.CacheArray[b].classList.add("border_right")};
CORE.Selector.prototype.jump=function(a,b){switch(a){case "up":CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-=0<=b?b-1:0;break;case "down":CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+=b-1}CORE.Sheets[CORE.CurrentSheet].updateHeight(a,b);CORE.Sheets[CORE.CurrentSheet].updateMenu();this.getSelection();this.selectCellByKeyPress();CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!0};
CORE.Selector.prototype.masterSelect=function(a){switch(typeof a){case "string":this.masterSelected.Columns[a]||(this.masterSelected.Columns[a]=new CORE.Sheets[CORE.CurrentSheet].Cell);break;case "number":this.masterSelected.Rows[a]||(this.masterSelected.Rows[a]=new CORE.Sheets[CORE.CurrentSheet].Cell)}this.masterSelected.Current=a};CORE.Selector.prototype.inheritMasterStyling=function(a,b,c){for(var e in CORE.Cells.Used[CORE.CurrentSheet][a])CORE.Cells.Used[CORE.CurrentSheet][a][e][c]=b[c]};
CORE.$={};
CORE.$.init=function(){CORE.$.isMobile();CORE.Settings.Scroll.OriginalVertical=CORE.Settings.Scroll.Vertical=CORE.$.calculateScrollAmount();CORE.Settings.Mobile&&FastClick.attach(document.body);CORE.Connector=new CORE.Connector;CORE.File=new CORE.File;CORE.Awakener=new CORE.Awakener;CORE.Sheets=new CORE.Sheets;CORE.Sheets.addSheet();CORE.Sheets.changeSheet(CORE.CurrentSheet);CORE.Event.init();CORE.Sheets[CORE.CurrentSheet].Selector=new CORE.Selector;CORE.Injector=new CORE.Injector;CORE.Sheets[CORE.CurrentSheet].Selector.parentSelectedCell={Letter:1,
Number:1};CORE.Sheets[CORE.CurrentSheet].Selector.selectCell(1,1);CORE.Connector.getURL()&&CORE.Connector.connect();CORE.Speedy=new CORE.Speedy};CORE.$.isMobile=function(){/iPhone|iPad|iPod|Android|Mobile/i.test(navigator.userAgent)&&(CORE.Settings.Mobile=!0)};CORE.$.calculateScrollAmount=function(){return Math.floor(Math.pow(CORE.Settings.Height,Math.floor(Math.log(CORE.Settings.Height)/Math.log(CORE.Settings.Height)))/100/4)};
CORE.$.numberToAlpha=function(a){var b=0,c=0,b=65+(a-1)%26,b=65>=b?String.fromCharCode(65):String.fromCharCode(b),c=parseInt((a-1)/26);return 0<c?CORE.$.numberToAlpha(c)+b:b};CORE.$.alphaToNumber=function(a){if(isNaN(a)){var b=0,c=a.charCodeAt(0),c=65>=c?1:c%65+1,b=parseInt(26*(c-1)),b=b+26;return(a=a.substr(1,a.length))?CORE.$.alphaToNumber(a)+b:c}};
CORE.$.getCell=function(a){var b=a.letter;a=CORE.Sheets[CORE.CurrentSheet].Settings.y*(b-1)+a.number-1-CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-CORE.Sheets[CORE.CurrentSheet].Settings.y*CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX;if(CORE.$.isInView(b,a)&&CORE.DOM.Output.children[a])return a};
CORE.$.isInView=function(a,b){return b<a*CORE.Sheets[CORE.CurrentSheet].Settings.y-CORE.Sheets[CORE.CurrentSheet].Settings.y-CORE.Sheets[CORE.CurrentSheet].Settings.y*CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX||b>=a*CORE.Sheets[CORE.CurrentSheet].Settings.y-CORE.Sheets[CORE.CurrentSheet].Settings.y*CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX?!1:!0};
CORE.$.validCell=function(){if(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter&&0<=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,b=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number;if(a&&0<b&&(CORE.$.registerCell({letter:a,number:b}),CORE.Cells.Used[CORE.CurrentSheet][a][a+b]))return!0}return!1};
CORE.$.validateCells=function(){for(var a=0;a<CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells.length;++a){var b=CORE.$.numberToAlpha(CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells[a].letter);CORE.$.registerCell({letter:b,number:CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells[a].number})}};
CORE.$.registerCell=function(a){var b=a.letter;a=b+a.number;CORE.Cells.Used[CORE.CurrentSheet][b]?CORE.Cells.Used[CORE.CurrentSheet][b][a]||(CORE.Cells.Used[CORE.CurrentSheet][b][a]=new CORE.Sheets[CORE.CurrentSheet].Cell):(CORE.Cells.Used[CORE.CurrentSheet][b]={},CORE.Cells.Used[CORE.CurrentSheet][b][a]=new CORE.Sheets[CORE.CurrentSheet].Cell)};
CORE.$.looseSelection=function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()};CORE.$.selectText=function(a){var b=a.textContent.length,c;document.selection?(c=document.selection.createRange(),c.moveStart("character",b),c.select()):(c=window.getSelection(),c.collapse(a.firstChild,b))};CORE.$.isJSON=function(a){try{JSON.parse(a)}catch(b){return!1}return!0};
CORE.$.isSafeInteger=function(a){return 9E15<=a&&a>=window.Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER-1:a};CORE.$.getVariables=function(a){return a.match(CORE.REGEX.variable)};
CORE.Grid.prototype.getEditSelection=function(a){if(a&&void 0!==a){var b=CORE.$.numberToAlpha(a.letter),c=a.number,e=0,d=null;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit=!0;e=CORE.$.getCell(a);0<=e&&(d=CORE.DOM.Output.children[e]);d&&d.classList.remove("cell_edit");d&&(d.classList.add("cell_edit"),CORE.Cells.Used[CORE.CurrentSheet][b]?CORE.Cells.Used[CORE.CurrentSheet][b][b+c]||CORE.registerCell(b+c):CORE.registerCell(b+c),CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Cells.Used[CORE.CurrentSheet][b][b+
c]&&(CORE.validCell(b+c)||CORE.registerCellVariable(b+c),CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Formula&&CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Formula.length&&CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Formula!==CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Content&&(d.innerHTML=CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Formula,this.goToEndOfCellText())));CORE.Sheets[CORE.CurrentSheet].Selector.Edit=b+c;CORE.DOM.CurrentCell.innerHTML=CORE.Sheets[CORE.CurrentSheet].Selector.Edit;CORE.Sheets[CORE.CurrentSheet].Selector.deleteCellHoverEffect();
CORE.Sheets[CORE.CurrentSheet].Selector.menuSelection(CORE.$.alphaToNumber(b)-1,c-1)}};
CORE.Grid.prototype.cleanEditSelection=function(){if(CORE.Sheets[CORE.CurrentSheet].Selector.Edit){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.numbers).join(""),b=~~CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.letters).join(""),c=this.Settings.y*(CORE.$.alphaToNumber(a)-1)+b-1-this.Settings.scrolledY-this.Settings.y*this.Settings.scrolledX;CORE.DOM.Output.children[c]&&CORE.DOM.Output.children[c].classList.remove("cell_edit");CORE.DOM.Output.children[c+CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY]&&
CORE.DOM.Output.children[c+CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY].classList.remove("cell_edit");CORE.DOM.Output.children[c-CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY]&&CORE.DOM.Output.children[c-CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY].classList.remove("cell_edit");CORE.Cells.Used[CORE.CurrentSheet][a]&&CORE.Cells.Used[CORE.CurrentSheet][a][a+b]&&CORE.Cells.Used[CORE.CurrentSheet][a][a+b].Formula&&CORE.Cells.Used[CORE.CurrentSheet][a][a+b].Formula.length&&CORE.Cells.Used[CORE.CurrentSheet][a][a+
b].Formula!==CORE.Cells.Used[CORE.CurrentSheet][a][a+b].Content&&(c=CORE.$.getCell({letter:a,number:b}),0<=c&&(CORE.DOM.Output.children[c].innerHTML=CORE.Cells.Used[CORE.CurrentSheet][a][a+b].Content))}CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit=!1};
CORE.Grid.prototype.goToEndOfCellText=function(){if(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number){var a=CORE.$.getCell({letter:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,number:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number});0<=a&&CORE.$.selectText(CORE.DOM.Output.children[a])}};CORE.File=function(){};CORE.File.prototype=CORE.File;
CORE.File.prototype.getData=function(){var a='"Cells":'+JSON.stringify(CORE.Cells)+",",b='"CellSizes":'+JSON.stringify(CORE.Grid.customCellSizes)+",",c='"CellStack":'+JSON.stringify(ENGEL.STACK.VAR)+",",e='"CoreSettings":'+JSON.stringify(CORE.Settings)+",",d='"GridSettings":'+JSON.stringify(CORE.Grid.Settings);return"{"+a+b+c+e+d+"}"};
CORE.File.prototype["import"]=function(a){a=JSON.parse(JSON.parse(a));CORE.Grid.customCellSizes=a.CellSizes;CORE.Grid.Settings=a.GridSettings;CORE.Cells=a.Cells;ENGEL.STACK.VAR=a.CellStack;CORE.Event.resize()};CORE.File.prototype["export"]=function(){var a=document.createElement("a");document.body.appendChild(a);a.style.display="none";var b=JSON.stringify(this.getData()),b=new Blob([b],{type:"application/json"}),b=window.URL.createObjectURL(b);a.href=b;a.download="Untitled.nvc";a.click();window.URL.revokeObjectURL(b)};
CORE.File.prototype.exportImage=function(){AJAX.POST(this.getData(),"server/base64ToImage.php",function(a){var b=new Image;b.src="server/uploads/"+a;CORE.DOM.FileOutput.innerHTML="";CORE.DOM.FileOutput.appendChild(b);CORE_UI.MODAL.FileImageOutput.$.style.display="block"})};CORE.Awakener=function(){this.currentlyRunning={}};CORE.Awakener.prototype=CORE.Awakener;CORE.Awakener.prototype.evalLive=function(){for(var a in CORE.Cells.Live)CORE.Cells.Live[a].Url&&(this.asleep(a),this.awake(a))};
CORE.Awakener.prototype.awake=function(a){var b=this;CORE.Cells.Live[a]&&!CORE.Cells.Live[a].Active&&(CORE.Cells.Live[a].Active=!0,this.currentlyRunning[a]=setInterval(function(){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit||b.get(a)},CORE.Cells.Live[a].RefreshTime))};CORE.Awakener.prototype.asleep=function(a){this.currentlyRunning[a]&&(window.clearInterval(this.currentlyRunning[a]),CORE.Cells.Live[a].Active=!1)};
CORE.Awakener.prototype.get=function(a){var b=this;AJAX.GET(CORE.Cells.Live[a].Url,function(c){CORE.Cells.Live[a].Data=c;b.processData(a)})};CORE.Awakener.prototype.processData=function(a){var b=a.match(CORE.REGEX.numbers).join("");CORE.Cells.Live[a].Data&&CORE.Cells.Live[a].Data.length&&(CORE.Cells.Used[b][a]||CORE.registerCell(a),CORE.$.isJSON(CORE.Cells.Live[a].Data)&&(CORE.Cells.Live[a].Data=JSON.parse(CORE.Cells.Live[a].Data)),CORE.eval())};
CORE.Awakener.prototype.reset=function(){for(var a in CORE.Cells.Live)CORE.Cells.Live[a].Active=!1};CORE.Connector=function(){this.socket=null;this.url="http://134.255.219.177";this.port=3E3;this.state=null;this.connected=!1;this.connectionStreak=0;this.states={0:"Stable",1:"Danger",2:"Lost"};this.room=null};CORE.Connector.prototype=CORE.Connector;CORE.Connector.prototype.constructor=CORE.Connector;
CORE.Connector.prototype.connect=function(){if(!window.io)throw Error("NovaeCalc requires socket.io!");this.socket=io.connect(this.url+":"+this.port);this.initListeners();this.createRoom()};CORE.Connector.prototype.initListeners=function(){var a=this;this.socket.on("connected",function(){a.state=0;a.connectionStreak=(new Date).getTime();a.connected=!0});this.socket.on("message",function(b){a.message(b)})};
CORE.Connector.prototype.message=function(a){if(a&&a.type)switch(a.type){case "room":this.room=a.values;this.socket.emit("getroom",{room:this.room});break;case "roomdata":this.room&&a.data&&this.processServerCells(a.data.sheets);break;case "global":switch(a.action){case "cellchange":this.processServerCell(a.data);break;case "scrolling":this.processServerScrolling(a.data);break;case "newsheet":this.processNewSheet(a.data)}}};
CORE.Connector.prototype.connectionTime=function(){return Math.floor((new Date).getTime()/1E3-this.connectionStreak/1E3)};
CORE.Connector.prototype.createRoom=function(){var a=this,b=this.getURL(),c="";b&&b.length&&(b=b.slice(1,b.length),this.socket.emit("createroom",{name:b,sheet:CORE.CurrentSheet},function(b){b?prompt("Please save the following master access key for this room!",b):(c=prompt("Please enter the room password: "),a.socket.emit("securitypassword",{password:c,room:a.room,sheet:CORE.CurrentSheet},function(b){a.processServerCells(b);a.processNewSheet({sheet:CORE.CurrentSheet})}))}))};
CORE.Connector.prototype.loginModal=function(){if(window.mui){var a=document.createElement("div");a.style.width="400px";a.style.height="300px";a.style.margin="100px auto";a.style.backgroundColor="#fff";a.innerHTML='<form> <legend>Title</legend> <div class="mui-form-group"> <input type="text" class="mui-form-control" required> <label class="mui-form-floating-label">Required Text Field</label> </div><div class="mui-form-group"> <input type="email" class="mui-form-control" required> <label class="mui-form-floating-label">Required Email Address</label> </div><div class="mui-form-group"> <textarea class="mui-form-control" required></textarea> <label class="mui-form-floating-label">Required Textarea</label> </div><div class="mui-form-group"> <input type="email" class="mui-form-control" value="Validation error"> <label class="mui-form-floating-label">Email Address</label> </div><button type="submit" class="mui-btn mui-btn-default mui-btn-raised">Submit</button></form>';
mui.overlay("on",a)}};CORE.Connector.prototype.getURL=function(){if(window.location.search)return window.location.search};CORE.Connector.prototype.action=function(a,b){switch(a){case "updateCell":this.updateCell(b);break;case "scrolling":this.updateScrolling(b);break;case "changeSheet":this.changeSheet(b)}};CORE.Connector.prototype.changeSheet=function(a){a&&a.sheet&&"string"===typeof a.sheet&&this.socket.emit("changesheet",{sheet:a.sheet})};
CORE.Connector.prototype.updateScrolling=function(a){a.direction&&a.amount&&0<=a.position&&"string"===typeof a.direction&&"number"===typeof a.amount&&"number"===typeof a.position&&this.socket.emit("scrolling",{direction:a.direction,amount:a.amount,position:a.position})};CORE.Connector.prototype.updateCell=function(a){a.cell&&a.value&&a.value.length&&(a.letter=a.cell.match(CORE.REGEX.numbers).join(""),a.sheet=CORE.CurrentSheet,this.socket.emit("updatecell",a))};
CORE.Connector.prototype.processServerCells=function(a){for(var b in a){CORE.Sheets[b]||(CORE.Sheets[b]=new CORE.Grid,CORE.Sheets.addSheet(b));for(var c in a[b].cells)for(var e in a[b].cells[c])CORE.Cells.Used[b]||(CORE.Cells.Used[b]={}),CORE.Cells.Used[b][c]||(CORE.Cells.Used[b][c]={}),CORE.Cells.Used[b][c][e]||(CORE.Cells.Used[b][c][e]=new CORE.Grid.Cell),"="===a[b].cells[c][e][0]?CORE.Cells.Used[b][c][e].Formula=a[b].cells[c][e]:CORE.Cells.Used[b][c][e].Content=a[b].cells[c][e]}CORE.Sheets[CORE.CurrentSheet].updateWidth("default");
CORE.eval()};CORE.Connector.prototype.processServerCell=function(a){CORE.Cells.Used[a.sheet][a.letter]||(CORE.Cells.Used[a.sheet][a.letter]={});CORE.Cells.Used[a.sheet][a.letter][a.cell]||(CORE.Cells.Used[a.sheet][a.letter][a.cell]=new CORE.Grid.Cell);"="===a.value[0]?";"===a.value[a.value.length-1]&&(CORE.Cells.Used[a.sheet][a.letter][a.cell].Formula=a.value):CORE.Cells.Used[a.sheet][a.letter][a.cell].Content=a.value;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");CORE.eval()};
CORE.Connector.prototype.processServerScrolling=function(a){a&&a.sheet===CORE.CurrentSheet&&a.direction&&"string"===typeof a.direction&&0<=["up","down","left","right"].indexOf(a.direction)&&a.amount&&"number"===typeof a.amount&&a.position&&"number"===typeof a.position&&0<=["up","down"].indexOf(a.direction)&&("up"===a.direction?0>=a.position-1-CORE.Settings.Scroll.Vertical?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=0,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=0,CORE.Sheets[CORE.CurrentSheet].updateHeight("default",
CORE.Settings.Scroll.Vertical),CORE.Event.animateMouseUpMaximum()):(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=a.position,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=a.amount,CORE.Sheets[CORE.CurrentSheet].updateHeight(a.direction,a.amount),CORE.Event.animateMouseUp()):"down"===a.direction&&(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=a.position,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=a.amount,CORE.Sheets[CORE.CurrentSheet].updateHeight(a.direction,a.amount),CORE.Event.animateMouseDown()),
CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!0,CORE.Sheets[CORE.CurrentSheet].updateMenu(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection())};CORE.Connector.prototype.processNewSheet=function(a){a.sheet&&"string"===typeof a.sheet&&(CORE.Sheets[a.sheet]||(CORE.Sheets[a.sheet]=new CORE.Grid,CORE.Sheets.addSheet(a.sheet)),CORE.Sheets.changeSheet(a.sheet))};var root=this,ENGEL=ENGEL||{};ENGEL.prototype=ENGEL;ENGEL.prototype.constructor=ENGEL;
ENGEL.prototype.init=function(){this.Lexer=new ENGEL.LEXER;this.Parser=new ENGEL.PARSER;this.Evaluator=new ENGEL.EVAL};ENGEL.prototype.interpret=function(a){this.lexed=this.Lexer.lex(a);this.ast=this.Parser.parse(this.lexed);this.Evaluator.evaluate(this.ast);return ENGEL.STACK};root.ENGEL=ENGEL;ENGEL.STACK={VAR:{}};ENGEL.STACK.prototype=ENGEL.STACK;ENGEL.STACK.prototype.dump=function(){this.VAR={}};ENGEL.STACK.prototype.get=function(a){if(this.VAR[a])return this.VAR[a]};
ENGEL.STACK.prototype.getValue=function(a){if(this.VAR[a])return this.VAR[a].value.value};ENGEL.STACK.prototype.update=function(a,b){if(this.VAR[a])return this.VAR[a].value=b};ENGEL.STACK.prototype.createVariable=function(a){if(!this.VAR[a])return this.VAR[a]={name:"undefined",type:"var",value:{value:null,type:null,raw:null}},this.VAR[a]};
ENGEL.LEXER=function(){this.Tokens=[];this.KeyWords=[{name:"LX_IF",rx:/^(wenn|if)(?![a-zA-Z0-9_])/},{name:"LX_ELSE",rx:/^(sonst|else)(?![a-zA-Z0-9_])/},{name:"LX_LPAR",rx:/^[\\(]()+/},{name:"LX_RPAR",rx:/^[\\)]()+/},{name:"LX_LBRAC",rx:/^[\\{]+/},{name:"LX_RBRAC",rx:/^[\\}]+/},{name:"LX_LHBRAC",rx:/^\[.*?/},{name:"LX_RHBRAC",rx:/^\].*?/},{name:"LX_SEMIC",rx:/^[;]+/},{name:"LX_EQ",rx:/^==/},{name:"LX_NEQ",rx:/^!=/},{name:"LX_AND",rx:/^(&&)/},{name:"LX_OR",rx:/^([\\|\\|])+/},{name:"LX_GRE",rx:/^>=/},
{name:"LX_LWE",rx:/^<=/},{name:"LX_GR",rx:/^>/},{name:"LX_LW",rx:/^</},{name:"LX_ASSIGN",rx:/^=/},{name:"LX_COMMA",rx:/^,/},{name:"LX_JSON",rx:/^(JSON)/},{name:"LX_JSON_CALL",rx:/^->/},{name:"LX_MATH",rx:/^(roundTo|asin|sin|acos|cos|atan|atan2|tan|sqrt|cbrt|exp|random|min|max|round|floor|ceil)/},{name:"LX_CONNECT",rx:/^(verbinden|connect)/},{name:"LX_VAR",rx:/^[a-zA-Z_][a-zA-Z0-9_]*/},{name:"LX_NUMBER",rx:/^[-]?[0-9]+(\.\d+[0-9]*)?/},{name:"LX_STRING",rx:/^"(\\\\"|[^"])(.*?)"|'"'(\\\\'|[^'])*'"/},
{name:"LX_PLUS",rx:/^\+(?!\+)/},{name:"LX_MINUS",rx:/^\-(?!-)/},{name:"LX_MULT",rx:/^[*]+/},{name:"LX_DIV",rx:/^[/]+/},{name:"LX_POW",rx:/^[^]/}];this.reservedKeyWords=["INFINITY","NAN"];this.isVariable=/^[A-Z]+[0-9]+$/;this.blank=/^[ \t\v\f]+/;this.notBlank=/^\S+/;this.lineBreak=/^[\r\n]+/;this.isBlank=function(a){return a.match(this.blank)};this.isNotBlank=function(a){return a.match(this.notBlank)};this.isLineBreak=function(a){return a.match(this.lineBreak)};this.isValidVariable=function(a){return a.match(this.isVariable)}};
ENGEL.LEXER.prototype=ENGEL.LEXER;
ENGEL.LEXER.prototype.lex=function(a){for(this.Tokens=[];a;){for(var b=this.isLineBreak(a)||this.isBlank(a),c=0;!b&&c<this.KeyWords.length;++c)if(b=a.match(this.KeyWords[c].rx)){0<=["LX_UPLUS","LX_UMINUS"].indexOf(this.KeyWords[c].name)&&(b[0]=b[0].slice(0,-1));"LX_VAR"===this.KeyWords[c].name&&(b[0]=b[0].toUpperCase(),0<=this.reservedKeyWords.indexOf(b[0])&&console.log(b[0]+" is a reserved word and shall not be used!"),this.isValidVariable(b[0])||console.log(b[0]+" is a invalid variable name!"));
if("LX_NUMBER"===this.KeyWords[c].name&&"LX_NUMBER"===this.Tokens[this.Tokens.length-1].type&&0>parseFloat(b[0])){this.Tokens.push({type:"LX_MINUS",value:"-"});b[0]=b[0].slice(0,1);break}if(0<=["LX_MINUS","LX_PLUS"].indexOf(this.KeyWords[c].name)&&-1>=["LX_NUMBER","LX_VAR","LX_STRING","LX_RPAR"].indexOf(this.Tokens[this.Tokens.length-1].type)&&"("===a.substring(b[0].length)[0]){switch(this.KeyWords[c].name){case "LX_PLUS":this.Tokens.push({type:"LX_UPLUS",value:b[0].trim()});break;case "LX_MINUS":this.Tokens.push({type:"LX_UMINUS",
value:b[0].trim()})}b[0]=b[0].slice(0,1);break}this.Tokens.push({type:this.KeyWords[c].name,value:b[0].trim()})}if(!b){console.log(a[0]+" is not defined!");break}if(b||this.notBlank(a))a=a.substring(b[0].length);else break}return this.Tokens};ENGEL.PARSER=function(){this.currentBlock=this.block=null;this.ReservedFunctions=["LX_CONNECT","LX_JSON"];this.MathFunctions=["LX_MATH"]};ENGEL.PARSER.prototype=ENGEL;ENGEL.PARSER.prototype.parse=function(a){return this.createAST(a)};
ENGEL.PARSER.prototype.createAST=function(a){if(!a[0])return a;this.block=a;if("LX_VAR"===this.block[0].type)return this.variable()};ENGEL.PARSER.prototype.variable=function(){var a=this.block,b={AssignmentExpression:{id:{type:"Identifier",name:a[0].value},init:null,kind:"var"}},c=b.AssignmentExpression;"LX_VAR"===a[0].type&&a.shift();if(a[0]&&"LX_ASSIGN"===a[0].type)return this.shift(),c.init=this.expressionStatement(),b};
ENGEL.PARSER.prototype.expressionStatement=function(){var a=this.block,b=null;a[a.length-1]&&"LX_SEMIC"!==a[a.length-1].type&&this.addSemicolon();this.shift();b=this.ruleExpression();return{ExpressionStatement:b}};
ENGEL.PARSER.prototype.functionAssignment=function(){var a=this.block,b={callee:{Identifier:a[0].value},arguments:[]};this.shift();"LX_CONNECT"===this.currentBlock.type?"LX_LPAR"===a[0].type&&(b.arguments=this.readFunctionArguments()):0<=this.MathFunctions.indexOf(this.currentBlock.type)?"LX_LPAR"===a[0].type&&(b.arguments=this.readFunctionArguments()):"LX_JSON"===this.currentBlock.type&&("LX_LPAR"===a[0].type&&(b.arguments=this.readFunctionArguments()),b.append=[],this.shift(),this.shift(),b.append=
this.readFunctionArguments());this.shift();this.shift();return{CallExpression:b}};
ENGEL.PARSER.prototype.readFunctionArguments=function(){var a=this.block,b=[],c=[],e=[],d=0;if(this.emptyArguments())return[];for(;a[0];){0<=this.ReservedFunctions.concat(this.MathFunctions).indexOf(a[0].type)&&(b.push(this.functionAssignment()),this.shift(),a.shift());"LX_LPAR"===a[0].type?d++:"LX_RPAR"===a[0].type&&d--;if(0<=["LX_COMMA","LX_JSON_CALL"].indexOf(a[0].type))b.push(c),c=[];else if(0<=["LX_RPAR","LX_SEMIC"].indexOf(a[0].type)&&0>=d){b.push(c);break}-1>=["LX_COMMA","LX_JSON_CALL"].indexOf(a[0].type)&&
c.push(a[0]);a.shift()}for(c=0;c<b.length;++c)b[c].CallExpression?e.push(b[c]):(this.block=b[c],this.shift(),this.addSemicolon(),e.push(this.ruleExpression()));this.block=a;return e};ENGEL.PARSER.prototype.emptyArguments=function(){return this.block[0]&&this.block[1]&&"LX_LPAR"===this.block[0].type&&(this.shift(),"LX_RPAR"===this.block[0].type)?(this.shift(),this.shift(),!0):!1};ENGEL.PARSER.prototype.addSemicolon=function(){this.block.push({type:"LX_SEMIC",value:";"})};
ENGEL.PARSER.prototype.ruleExpression=function(){var a;for(this.accept("LX_MINUS")||(this.accept("LX_PLUS")?this.shift():a=this.ruleTerm());this.accept("LX_PLUS LX_MINUS LX_EQ LX_NEQ LX_GR LX_GRE LX_LW LX_LWE LX_AND LX_OR".split(" "));)a={operator:this.currentBlock.type,left:a},this.shift(),a.right=this.ruleTerm();return a};
ENGEL.PARSER.prototype.ruleTerm=function(){var a;for(a=this.ruleFactor();this.accept("LX_POW LX_MULT LX_DIV LX_EQ LX_NEQ LX_GR LX_GRE LX_LW LX_LWE LX_AND LX_OR".split(" "));)a={operator:this.currentBlock.type,left:a},this.shift(),a.right=this.ruleFactor();return a};
ENGEL.PARSER.prototype.ruleFactor=function(){var a,b;this.accept(["LX_NUMBER","LX_VAR","LX_STRING"])?(b=0<=["LX_NUMBER","LX_STRING"].indexOf(this.currentBlock.type)?"Literal":"Identifier",a={},a[b]={value:ENGEL.TypeMaster(this.currentBlock.value).value},this.shift()):this.accept("LX_LPAR")?(this.shift(),a=this.ruleExpression(),this.expect("LX_RPAR")&&this.shift()):this.accept(["LX_UPLUS","LX_UMINUS"])?(a={operator:this.currentBlock.type},this.shift(),a.init=this.ruleFactor()):this.accept(this.ReservedFunctions.concat(this.MathFunctions))&&
(this.block.unshift(this.currentBlock),a=this.functionAssignment());return a};ENGEL.PARSER.prototype.accept=function(a){if(!this.block[0])return!1;if("string"===typeof a){if(this.currentBlock&&this.currentBlock.type===a)return!0}else for(var b=0;b<a.length;++b)if(this.currentBlock&&this.currentBlock.type===a[b])return!0;return!1};ENGEL.PARSER.prototype.shift=function(){this.currentBlock=this.block.shift()};ENGEL.PARSER.prototype.expect=function(a){return this.accept(a)?!0:!1};
ENGEL.EVAL=function(){var a=this;this.functionName=this.switcher=null;this.Functions={LX_POW:function(b){return Math.pow(a.interpretExpression(b.left),a.interpretExpression(b.right))},LX_UPLUS:function(b){return+a.interpretExpression(b)},LX_UMINUS:function(b){return-a.interpretExpression(b)},LX_PLUS:function(b){return a[a.switcher](b.left,a.functionName)+a[a.switcher](b.right,a.functionName)},LX_MINUS:function(b){return a[a.switcher](b.left,a.functionName)-a[a.switcher](b.right,a.functionName)},LX_MULT:function(b){return a[a.switcher](b.left,
a.functionName)*a[a.switcher](b.right,a.functionName)},LX_DIV:function(b){return a[a.switcher](b.left,a.functionName)/a[a.switcher](b.right,a.functionName)},LX_EQ:function(b){return a[a.switcher](b.left,a.functionName)==a[a.switcher](b.right,a.functionName)},LX_NEQ:function(b){return a[a.switcher](b.left,a.functionName)!=a[a.switcher](b.right,a.functionName)},LX_LW:function(b){return a[a.switcher](b.left,a.functionName)<a[a.switcher](b.right,a.functionName)},LX_GR:function(b){return a[a.switcher](b.left,
a.functionName)>a[a.switcher](b.right,a.functionName)},LX_LWE:function(b){return a[a.switcher](b.left,a.functionName)<=a[a.switcher](b.right,a.functionName)},LX_GRE:function(b){return a[a.switcher](b.left,a.functionName)>=a[a.switcher](b.right,a.functionName)},LX_AND:function(b){var c=a[a.switcher](b.left,a.functionName);return c?a[a.switcher](b.right,a.functionName):c},LX_OR:function(b){var c=a[a.switcher](b.left,a.functionName);return c?c:a[a.switcher](b.right,a.functionName)}};this.preDefFunc=
{display:["log","print"],math:"asin sin acos cos atan atan2 tan sqrt cbrt exp random min max round floor ceil roundTo".split(" "),json:["JSON","json"],ajax:["CONNECT","connect"]}};ENGEL.EVAL.prototype=ENGEL;
ENGEL.EVAL.prototype.evalVariable=function(a){var b=a.kind;"Identifier"===a.id.type&&(ENGEL.STACK.VAR[a.id.name]={name:a.id.name,type:b,value:{value:null,type:null,raw:null}});a.init&&(a.init.ExpressionStatement?(b=this.interpretExpression(a.init.ExpressionStatement),ENGEL.STACK.update(a.id.name,{raw:b,value:this.TypeMaster(b).value,type:typeof b})):a.init.CallExpression&&this.evalExpression(a.init.CallExpression,a.id.name))};ENGEL.EVAL.prototype.evaluate=function(a){a.AssignmentExpression&&this.evalVariable(a.AssignmentExpression)};
ENGEL.EVAL.prototype.interpretExpression=function(a){if(!isNaN(a))return a;if(a){this.switcher="interpretExpression";if(a.init)return this.Functions[a.operator](a.init);if(a.CallExpression)return this.evalExpression(a.CallExpression);if(a.Identifier)return(a=ENGEL.STACK.getValue(a.Identifier.value))||""===a||0===a?a:0;if(a.Literal)return a.Literal.value;if(this.Functions[a.operator])return this.Functions[a.operator](a)}};
ENGEL.EVAL.prototype.evalExpression=function(a,b){var c=a.callee;if(0<=this.preDefFunc.ajax.indexOf(c.Identifier)){var e="",d=0,e=this.interpretExpression(a.arguments[0]),d=this.interpretExpression(a.arguments[1]);0>=d&&(console.info(b+": Invalid refresh time value, reset to 1000!"),d=1E3);CORE.Cells.Live[b]||CORE.registerLiveCell(b);CORE.Cells.Live[b]&&(CORE.Cells.Live[b].Url=e,CORE.Cells.Live[b].RefreshTime=d);CORE.Awakener.evalLive()}else if(0<=this.preDefFunc.json.indexOf(c.Identifier)){c=a.arguments[0].Identifier.value;
e=null;if(CORE.Cells.Live[c]){for(d=0;d<a.append.length;++d)a.append[d]=this.interpretExpression(a.append[d]);CORE.Cells.Live[c].Data&&(e=this.readJSONTree(CORE.Cells.Live[c].Data,a.append))}ENGEL.STACK.get(b)&&ENGEL.STACK.update(b,{raw:e,value:this.TypeMaster(e).value,type:typeof e})}else if(0<=this.preDefFunc.math.indexOf(c.Identifier)){for(var e=null,f=[],d=0;d<a.arguments.length;++d)a.arguments[d].CallExpression?f.push(this.evalExpression(a.arguments[d].CallExpression)):f.push(this.interpretExpression(a.arguments[d]));
window.Math[c.Identifier]&&(e=f&&f.length?Math[c.Identifier].apply(null,f):Math[c.Identifier].apply(null,null));b&&ENGEL.STACK.get(b)&&ENGEL.STACK.update(b,{raw:e,value:this.TypeMaster(e).value,type:typeof e});return e}};ENGEL.EVAL.prototype.readJSONTree=function(a,b){var c=null;if(void 0!==a[b[0]]||null!==a[b[0]])if(c=b.shift(),1<=b.length)return this.readJSONTree(a[c],b);return a[c]};
ENGEL.prototype.TypeMaster=function(a){var b={value:null,type:null,raw:a};b.value=a;if(!isNaN(a))b.value=parseFloat(a);else if("string"==typeof a||"object"==typeof a&&a.constructor===String)b.value=String(a.replace(/"/g,""));b.type=typeof b.value;return b};